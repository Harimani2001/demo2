<div class="row">
  <div class="col-sm-12">
    <app-card [title]="'Company Table'">
      <div>
        <button type="button" class="btn btn-primary" [routerLink]="['/organization/add-organization']" routerLinkActive="active">
          <i class="icofont icofont-plus-circle"></i> Add Organization
        </button>
      </div>
      <br>
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-sm-12 col-md-6">
          <div>
          </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6">
          <div style="text-align: right;">
            <label>Search:
              <input type="search" [(ngModel)]="filterQuery" (ngModelChange)="this.helper.setPaginator(table)"class="form-control input-sm full-data-search" placeholder="Search">
            </label>
          </div>
        </div>
      </div>
      <ngx-datatable style="overflow: unset!important;" [scrollbarH]="true" #myTable class="data-table dt-chk" [rows]='data | companyFilter : filterQuery' [limit]="rowsOnPage" [columnMode]="'force'"
        [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">
        <!-- Row Detail Template -->
        <ngx-datatable-row-detail [rowHeight]="'auto'" #myDetailRow (toggle)="onDetailToggle($event)">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
            <div class="dt-desc">
              <table class="table-striped table-bordered">
                <tr>
                  <th colspan="2">
                    <strong>Organization Description</strong>
                  </th>
                </tr>
                <tr>
                  <td>Number Of Users Created</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.organizationLicenseUsed}}</td>
                </tr>
                <tr>
                  <td>Country</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.country}}</td>
                </tr>
                <tr>
                  <td>State</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.state }}
                  </td>
                </tr>
                <tr>
                  <td>District</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.district}}</td>
                </tr>
                <tr>
                  <td>Street</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.street}}</td>
                </tr>
                <tr>
                  <td>Pincode</td>
                  <td style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row.pincode }}
                  </td>
                </tr>
                <tr>
                </tr>
              </table>
            </div>

          </ng-template>
        </ngx-datatable-row-detail>
        <ngx-datatable-column [width]="80" [resizeable]="false" [sortable]="false" [draggable]="false" [canAutoResize]="false">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <a href="javascript:;" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
              (click)="toggleExpandRow(row)"> </a>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Sl No." [width]="50">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong>{{row['$$index']+1}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column style="font-weight: bold;" name="Organization Name">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['organizationName']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Total No. of Organization License">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['organizationLicense']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Organization Email">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['organizationEmail']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Action">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <!-- <ng-template #popContent> -->
              <!-- <div *ngIf="row.kbCopied && row.kbUpdateAvailable" (click)="openSwalForUpdateKb(row.id)"><b>Update Knowledge Base</b></div>
              <div><b>Update Email Template</b></div> -->
            <!-- </ng-template> -->
            <a container="body" href="javascript:;" routerLinkActive="active" [routerLink]="['/organization/add-organization',row.id]" class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Edit">
              <i  class="icofont icofont-edit edit"></i>
            </a>
            <a container="body" href="javascript:;" class="m-r-15 crm-action-delete text-muted text-danger" (click)="openSuccessCancelSwal(row , row['$$index'] );" placement="top" ngbTooltip="Delete">
              <i  class="icofont icofont-bin bin"></i>
            </a>

            <a *ngIf="row.buildStatus" container="body" href="javascript:;" class="m-r-15 crm-action-success text-muted text-success" (click)="onClickUploadGxp(row);GXPUploadModal.show();" placement="top" ngbTooltip="Upload GxP Assesment Questions">
              <i  class="icofont icofont-file-excel edit"></i>
            </a>

            <a *ngIf="!row.buildStatus" container="body" href="javascript:;" class="m-r-15 crm-action-success text-muted text-success" (click)="completeInstallation(row);" placement="top" ngbTooltip="complete installation">
              <i  class="icofont icofont-bell-alt"></i>
            </a>

            <a container="body" href="javascript:;" class="m-r-15 crm-action-delete text-muted text-danger" (click)="deactivateOrg(row , row['$$index'] );" placement="top" ngbTooltip="Deactivate">
              <i class="fa fa-ban"></i>
            </a>

            <a class="dropdown">
              <a *ngIf="(row.kbCopied && row.kbUpdateAvailable)||(row.emailTemplateCopied && row.emailTemplateUpdateAvailable)||(row.emailRuleCopied && row.emailRuleUpdateAvailable)" 
                class="m-r-15 crm-action-delete text-muted text-danger dropbtn">
                <i style="font-size: 25px; color: royalblue;" class="icofont icofont-bell-alt"></i>
              </a>
              <div class="dropdown-content">
                <a *ngIf="row.kbCopied && row.kbUpdateAvailable" (click)="openSwalForUpdateKb(row.id)">Update Knowledge Base</a>
                <a *ngIf="row.emailTemplateCopied && row.emailTemplateUpdateAvailable" (click)="openSwalForUpdateEmailTemplate(row.id)">Update Email Template</a>
                <a *ngIf="row.emailRuleCopied && row.emailRuleUpdateAvailable" (click)="openSwalForUpdateEmailRule(row.id)">Update Eamil Rule</a>
              </div>
            </a>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </app-card>
  </div>
</div>
<app-modal-basic #GXPUploadModal [dialogClass]="'modal-md'">
  <div class="app-modal-header">
    <h4 class="modal-title strong">Upload GXP Form</h4>
    <button type="button" class="close basic-close" (click)="GXPUploadModal.hide();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="row">
      <div class="col-sm-6">
        <label class="custom-file">
          <input #myInput type="file" accept=".xlsx" (change)="extractFile($event);">
          <span class="custom-file-control"></span>
        </label>
      </div>
      <div class="col-sm-6 text-right">
        <button type="button" class="btn btn-info waves-effect btn-sm" (click)="downloadGxpQuestions()">Sample Download</button>
      </div>
      <div *ngIf="modalSpinnerFlag" class="loading">Loading&#8230;</div>
    </div>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-success waves-effect btn-sm" (click)="uploadFile()">Upload</button>
    <button type="button" class="btn btn-danger waves-effect btn-sm" (click)="GXPUploadModal.hide();onCancel();">Cancel</button>
  </div>
</app-modal-basic>
 <div *ngIf="isFlag" class="loading">Loading&#8230;</div>