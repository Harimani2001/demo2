
<!-- Add Or Edit New Chapter -->
<app-card *ngIf="!viewFlag">
    <div class="row">
        <div class="col-sm-12">
            <form #PDFChapter="ngForm">
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Chapter Name<span class="asterisk required">*</span></label>
                    <div class="col-sm-12">
                        <input type="text" [(ngModel)]="pdfChapterModal.chapterName" class="form-control" name="projectName"
                            (ngModelChange) ="checkChapterEntry(pdfChapterModal.chapterName)" maxlength="249" placeholder="Chapter 1" #PDFChapterName="ngModel" required>
                        <div class="messages text-danger"
                            *ngIf="!this.isDuplicateChapter && (PDFChapterName.touched || submitted) && PDFChapterName.errors?.required">
                            Please enter chapter name</div>
                        <div class="messages text-danger"*ngIf="this.isDuplicateChapter">
                            Chapter name is present</div>
                    </div>
                </div>
                <div *ngIf="this.pdfChapterModal.id==0" class="form-group row">
                    <div class="col-sm-12">
                        <select name="select-type" class="form-control"  [(ngModel)]="pdfChapterModal.type">
                            <option value="">Chapter Content</option>
                            <option value="file">File Upload</option>
                        </select>
                
                    </div>
                </div>
                <div *ngIf="!pdfChapterModal.type" class="form-group row">
                    <label class="col-sm-2 col-form-label">Chapter Content</label>
                    <div class="col-sm-12">
                        <ui-switch ng-model="all" (click)="this.editorSwap=!this.editorSwap;" id="ui-switch" [checked]="editorSwap" 
                            class="js-small" color="#3498DB" switchColor="#fff" size="small">
                        </ui-switch>
                        
                        <label class="text-success" *ngIf="!editorSwap">Enable Advance Editor</label>
                      <label class="text-danger" *ngIf="editorSwap">Disable Advance Editor</label>
                      <div *ngIf="editorSwap">
                        <quill-editor [(ngModel)]="pdfChapterModal.chapterContent" [options]="this.helper.editQuillOptions"
                          (ready)="onEditorCreated($event)" name="description" #textarea="ngModel" required>
                        </quill-editor>
                        <div class="messages text-danger"
                          *ngIf="(textarea.touched || submitted) && textarea.errors?.required">Chapter Content is required
                        </div>
                      </div>
                      <ng-container *ngIf="!editorSwap">
                        <textarea class="form-control max-textarea" id="specDescription" rows="4"
                          [(ngModel)]="pdfChapterModal.chapterContent" name="description" #textarea="ngModel" required></textarea>
                        <div class="messages text-danger"
                          *ngIf="(textarea.touched || submitted) && textarea.errors?.required">Chapter Content is required
                        </div>
                      </ng-container>
                    <br>
                    </div>
                </div>
                <div class="form-group row" *ngIf="pdfChapterModal.type=='file'">
                    <app-file-upload-for-doc #fileupload [multiple]="false" accept=".pdf,.docx" [onlyView]=false [documentId]="this.pdfChapterModal.id" [update]="this.pdfChapterModal.id!=0" [download]="this.pdfChapterModal.id!=0" documentCode ="153"></app-file-upload-for-doc>
                    <div class="col-sm-12 messages text-danger" *ngIf="fileValidationMessage"> {{fileValidationMessage}}</div>
                </div>
                <div class="form-group row" *ngIf="pdfChapterModal.type=='table'">
                    <div class="table-responsive">
                        <table id="chapter-table" class="table table-framed">
                            <thead>
                                <tr>
                                    <th  *ngFor="let column of pdfChapterModal.tableData.columns;">
                                        {{column.label}}
                                    </th>
                                </tr>
                            </thead>
                            <tbody *ngFor="let row of pdfChapterModal.tableData.rows ; let i = index" [attr.data-index]="i">
                                <tr>
                                   <ng-container *ngFor="let column of pdfChapterModal.tableData.columns ; let j = index" [attr.data-index]="j">
                                  <td>
                                    <textarea class="form-control max-textarea"[name]='row.row[j].name' [(ngModel)]='row.row[j].value' #textContent="ngModel"
                                    rows="2"></textarea>
                                  </td>
                                </ng-container>
                                </tr>
                              </tbody>
                        </table>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Active Flag</label>
                    <label class="switch"><input type="checkbox" name="activeFlag"
                            [(ngModel)]="pdfChapterModal.activeFlag" /><span class="slider round"></span></label>
                </div>
                <div class="form-group row">
                    <div class="col-sm-12" style="text-align: center;">
                        <button type="button" [disabled]="!this.permissionModal.createButtonFlag || this.isDuplicateChapter"
                            *ngIf="!this.pdfChapterModal.id" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
                            (click)="$event.preventDefault();saveAndGoto(PDFChapter.valid);">Save</button>
                        <button type="button" [disabled]="!this.permissionModal.updateButtonFlag || this.isDuplicateChapter"
                            *ngIf="this.pdfChapterModal.id" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
                            (click)="$event.preventDefault();saveAndGoto(PDFChapter.valid);">Update</button>
                        <button type="button" class="btn btn-sm btn-danger waves-effect waves-light m-r-10"
                            (click)="viewFlag=true;cancel()">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</app-card>

<app-card *ngIf="viewFlag">
    <div class="row">
        <div class="col-sm-12">
            <button [disabled]="!permissionModal.createButtonFlag" type="button"
            class="btn btn-primary" (click)=addChapter();>
            <i class="icofont icofont-plus-circle"></i>
            Add Chapter</button>

            <button [disabled]="!permissionModal.importButtonFlag" type="button"
            class="btn btn-primary" (click)=bulkAddChapter();>Bulk Add Chapter</button>
        </div>
        <div class="col-sm-12">
                <br><br>
            <ngx-datatable  [scrollbarH]="true" #pdfChapterTable class="data-table dt-chk" style="overflow: unset!important;"
							[rows]='chapterList' [limit]="30" [columnMode]="'force'"
							[headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">
                            <!-- <ngx-datatable-row-detail [rowHeight]="'auto'" #myDetailRow >
                                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
                                  <div class="dt-desc">
                                    <table class="table-striped table-bordered">
                                        <tr>
                                            <th><strong>Chapter Content</strong>
                                            </th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <ckeditor *ngIf="row.chapterContent" [config]="this.configService.helper.viewConfigOfCkEditior"
                                                    name="description" [(ngModel)]="row.chapterContent"></ckeditor>
                                            </td>
                                        </tr>
                                    </table>
                                  </div>
                                </ng-template>
                              </ngx-datatable-row-detail>
                              <ngx-datatable-column [width]="50" [resizeable]="false" [sortable]="false" [draggable]="false" [canAutoResize]="false">
                                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                                  <a href="javascript:;" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
                                    (click)="toggleExpandRow(row)">
                                  </a>
                                </ng-template>
                              </ngx-datatable-column> -->
							<ngx-datatable-column name="Chapter Name">
								<ng-template let-row="row" ngx-datatable-cell-template> <strong
										style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['chapterName']}}</strong>
								</ng-template>
							</ngx-datatable-column>
                            <ngx-datatable-column name="Active">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <strong *ngIf="row['activeFlag']"
                                        style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">Active</strong>
                                    <strong *ngIf="!row['activeFlag']"
                                        style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">In Active</strong>
                                </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column name="Action">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                <a container="body" *ngIf="permissionModal.updateButtonFlag" href="javascript:;"  (click)="edit(row);"
                                 class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Edit">
                                    <i  class="icofont icofont-edit edit"></i>
                                  </a>
                                  <a container="body" *ngIf="permissionModal.deleteButtonFlag && !row.selectedForDocumentData" href="javascript:;"
										class="m-r-15 crm-action-delete text-muted text-danger"
										(click)="openSuccessCancelSwal(row , row['$$index'] );" placement="top"
										ngbTooltip="Delete">
										<i class="icofont icofont-bin bin"></i>
									</a>
                                </ng-template>
                            </ngx-datatable-column>
						</ngx-datatable>
        </div>
    </div>
</app-card>

<app-modal-basic  #bulkAddChapterModal [dialogClass]="'modal-lg'" class="modal-dialog">
    <div class="app-modal-header">
      <h4 class="modal-title">Bulk Add Chapter</h4>
      <button type="button" class="close basic-close" (click)="closeBulkAddChapter()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div style="max-height: 450px;" class="app-modal-body" >
        <div class="row">
            <label class="col-sm-2 col-form-label">No. of chapters<span class="asterisk required">*</span></label>
            <input class=" col-sm-3 form-control" type="number" min="1" max="10" name="count-for-sample-import"
                (keypress)="this.configService.helper.onlyNumber($event)" required [(ngModel)]="count" />
            <button type="button" class="ml-3 btn btn-sm btn-primary waves-effect waves-light"
                (click)=sampleDownload();>Sample
                Download</button>
            <div class="col-sm-5 text-center">
                <label class="col-form-label">Upload File<span class="asterisk required">*</span></label>
                <input type="file" multiple="false" accept=".docx" name="file" required (change)="extractFile($event);" />
                <span class="asterisk required" *ngIf="validationMessage">{{validationMessage}}</span>
            </div>
        </div><br>
        <div  style="max-height: 200px;"  class="dy-width-400 x-scroll-hide">
            <ng-container *ngIf="this.bulkChapterList.length>0">
                <div class="table-responsive">
                    <table id="tableIdDivRefresh1" #tableIdDivRefresh class="table table-striped table-bordered ">
                        <thead >
                            <tr>
                                <th>Sr No.</th>
                                <th>Chapter Name <span class="asterisk">*</span></th>
                                <th>Chapter Content <span class="asterisk">*</span></th>
                                <th>Active Flag </th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr  *ngFor="let row of bulkChapterList ; let i = index" [attr.data-index]="i">
                                <td>
                                    <label>{{i+1}}</label>
                                </td>
                                <td>
                                    <input name="chapterName-{{i}}" type="text" [(ngModel)]="row.chapterName" (ngModelChange)="check(row);"
                                        class="form-control" />
                                    <div class="messages text-danger" *ngIf="!row.chapterNameExists && !row.chapterName">Chapter Name can't be blank</div>
                                    <div class="messages text-danger" *ngIf="row.chapterNameExists">Chapter Name already exists</div>
                                </td>
                                <td style="height: 200px; width: 100px;">
                                    <quill-editor #disciplineQE id="discipline-qe" [options]="this.helper.editQuillOptions"
                                        name="chapterContent-{{i}}" required [(ngModel)]="row.chapterContent">
                                    </quill-editor>
                                    <div class="messages text-danger" *ngIf="!row.chapterContent">Chapter Content can't be blank
                                    </div>
                                </td>
                                <td>
                                    <label class="switch"><input type="checkbox" name="activeFlag-{{i}}"
                                            [checked]="row.activeFlag" (change)="row.activeFlag=!row.activeFlag" /><span
                                            class="slider round"></span></label>
                                </td>
                                <td>
                                    <a container="body" role="button" class="m-r-15 crm-action-delete text-muted text-danger"
                                    (click)="this.configService.helper.remove(bulkChapterList,i,1);" placement="top"
                                    ngbTooltip="Remove">
                                    <i  class="icofont icofont-bin bin"></i>
                                </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center" class="messages text-danger" *ngIf="this.enableImportButton">Please Fill all the
                    mandatory
                    Data</div>
                <br>
                <div class="form-group row">
                    <div style="text-align: center">
                        <button type="button" class="btn btn-success"
                            [disabled]="!permissionModal.createButtonFlag" (click)="saveBulkChapter()">Import
                        </button>
                        <p class="messages text-danger" *ngIf="!permissionModal.createButtonFlag">You don't have create permission,
                            please contact admin..!</p>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
    <div class="app-modal-footer">
      <button type="button" class="btn btn-default waves-effect" (click)="closeBulkAddChapter()">Cancel</button>
    </div>
  </app-modal-basic>