<div class="row" *ngIf="!viewIndividualData">
  <div class="col-sm-12" id="float-action">
    <app-card>
      <div class="row">
        <div class="col-sm-2">
          <p><b>No of active sessions : {{this.activeSessionCount}}</b></p>
        </div>
        <div class="col-sm-2">
          <angular2-multiselect name="departmentName" [data]="this.deptList" id="departmentId"
            (ngModelChange)="filterUsersList($event)" [(ngModel)]="this.department" [settings]="dropdownSettings">
          </angular2-multiselect>
        </div>
        <div class="col-sm-4">
          <p *ngIf="!permisionModal.createButtonFlag && permissionValue!=''"
            style="color: red; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">
            You don't have create permission, please contact admin..!</p>
          <strong *ngIf="licenseMessage != ''" style="color: red;">{{licenseMessage}}</strong>
        </div>
        <div class="col-sm-4 text-right">
          <a href="javascript:" class="m-r-15"><img class="image-radius rounded-0 img-25"
              src="assets/icon/png-icons/search.png" alt="Search" placement="bottom" ngbTooltip="Search"
              (click)="this.showSearch=!this.showSearch"></a>
          <input *ngIf="this.showSearch" type="search" [(ngModel)]="filterQuery"
            (ngModelChange)="this.helper.setPaginator(table)" class="form-control input-sm full-data-search m-r-15"
            placeholder="Search">

          <a *ngIf="this.licenseMessage == '' && permisionModal.createButtonFlag" href="javascript:" class="m-r-15"><img
              class="image-radius rounded-0 img-27" [routerLink]="['/userManagement/add-user']"
              routerLinkActive="active" src="assets/icon/png-icons/addDoc.png" alt="Add User" placement="bottom"
              ngbTooltip="Add User"></a>

          <a *ngIf="this.licenseMessage == '' && permisionModal.createButtonFlag" href="javascript:" class="m-r-15"><img
              class="image-radius rounded-0 img-25" src="assets/icon/png-icons/import.png" alt="Bulk Import"
              placement="bottom" ngbTooltip="Bulk Import" (click)="onBulkImport()"></a>

          <a *ngIf="isADConfigured && this.licenseMessage == ''&& permisionModal.createButtonFlag"
            href="javascript:"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/import.png"
              alt="Bulk Import" placement="bottom" ngbTooltip="Bulk Import" (click)="openBulkAddUserByADModal()"></a>
        </div>
      </div>
    </app-card>
  </div>

  <div class="col-sm-12">
    <br><br><br>
    <app-card>
      <ngx-datatable [scrollbarH]="true" #myTable class="data-table dt-chk" [rows]='userList | userFilter : filterQuery'
        [limit]="10" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'"
        (page)="onPage($event)">
        <ngx-datatable-row-detail [rowHeight]="'auto'" #myDetailRow>
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
            <div class="dt-desc">
              <table class="table-striped table-bordered">
                <tr>
                  <th colspan="2">
                    <strong>User Details</strong>
                  </th>
                </tr>
                <tr>
                  <td style="font-weight:bold;">User Type:</td>
                  <td class="fontStyle">{{row.loginType}}</td>
                </tr>
              </table>
            </div>
          </ng-template>
        </ngx-datatable-row-detail>
        <ngx-datatable-column [width]="50" [resizeable]="false" [sortable]="false" [draggable]="false"
          [canAutoResize]="false">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <a href="javascript:;" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded"
              title="Expand/Collapse Row" (click)="toggleExpandRow(row)">
            </a>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="User Name">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['userName']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Designation">
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['designation']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Email">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['email']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="First Name">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['firstName']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Last Name">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['lastName']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Contact">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['phoneNo']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Role">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['roleName']}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Status">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <strong class="fontStyle">{{row['activeFlag']==='Y'?'Active':'In-Active'}}</strong>
            <span *ngIf="row['activeSession']" class="dot user-active"></span>
            <span *ngIf="!row['activeSession']" class="dot user-in-active"></span>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Action">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <a *ngIf="permisionModal.updateButtonFlag" container="body" href="javascript:;" routerLinkActive="active"
              [routerLink]="['/userManagement/add-user',row.id]" class="m-r-10 crm-action-edit text-muted text-primary"
              placement="top" ngbTooltip="Edit">
              <i class="icofont icofont-edit edit"></i>
            </a>
            <a *ngIf="permisionModal.deleteButtonFlag && row['id']!=this.disableDeleteOfUser" container="body"
              href="javascript:;" class="m-r-10 crm-action-delete text-muted text-danger"
              (click)="openSuccessCancelSwal(row , row['$$index'] );" placement="top" ngbTooltip="Delete">
              <i class="icofont icofont-bin bin"></i>
            </a>
            <a container="body" *ngIf="permisionModal.viewButtonFlag" href="javascript:;" class="m-r-10 crm-action-view"
              (click)="viewRowDetails(row.id);" data-ng-open="modalSmall" placement="top" ngbTooltip="View">
              <i class="icofont icofont-resize view"></i>
            </a>
            <a container="body" href="javascript:;" class="crm-action-edit text-primary" (click)="reinvitation(row.id);"
              data-ng-open="modalSmall" placement="top" ngbTooltip="Reinvitation">
              <i style="font-size: 23px;" class="icofont icofont-mail"></i>
            </a>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </app-card>
  </div>
</div>

<div class="row" *ngIf="viewIndividualData">
  <div class="col-sm-12" id="float-action">
    <app-card>
      <div class="row">
        <div class="col-sm-8">
          <label><b>No of active sessions : {{this.activeSessionCount}}</b></label>
        </div>
        <div class="col-sm-4 text-right">
          <button *ngIf="permisionModal.updateButtonFlag" type="submit"
            [routerLink]="['/userManagement/add-user',userData.id]" routerLinkActive="active"
            class="btn btn-sm btn-primary  waves-effect waves-light m-r-10">Edit</button>

          <button *ngIf="permisionModal.deleteButtonFlag && userData['id']!=this.disableDeleteOfUser" type="button"
            class="btn btn-sm btn-danger waves-effect waves-light m-r-10"
            (click)="openSuccessCancelSwal(userData , userData['$$index'] );">Delete</button>

          <button type="button" class="btn btn-sm btn-danger  waves-effect waves-light"
            (click)="this.viewIndividualData = !this.viewIndividualData;">Cancel</button>
        </div>
      </div>
    </app-card>
  </div>

  <div class="col-sm-12">
    <br><br>
    <app-card>
      <div class="row">
        <div class="col-sm-12">
          <table id="add-table" class="table w-100">
            <tbody>
              <tr>
                <td>
                  <div><strong class="strong">User Name : </strong>{{userData.userName}}</div>
                </td>
                <td>
                  <div><strong class="strong">Email : </strong>{{userData.email}}</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div><strong class="strong">First Name : </strong>{{userData.firstName}}</div>
                </td>
                <td>
                  <div><strong class="strong">Last Name : </strong>{{userData.lastName}}</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div><strong class="strong">Mobile Number : </strong>{{userData.phoneNo ? userData.phoneNo : 'N/A'}}
                  </div>
                </td>
                <td>
                  <div><strong class="strong">Designation : </strong>{{userData.designation ? userData.designation :
                    'N/A'}}</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div><strong class="strong">Location : </strong>{{userData.locationName}}</div>
                </td>
                <td>
                  <div><strong class="strong">Department : </strong>{{userData.departmentIdName}}</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div><strong class="strong">Manager : </strong>{{userData.managerName ? userData.managerName : 'N/A'}}
                  </div>
                </td>
                <td>
                  <div><strong class="strong">HOD : </strong>{{userData.hodFlag=='Y' ? 'Yes' : 'No'}}</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div><strong class="strong">Role : </strong>{{userData.roleName}}</div>
                </td>
                <td>
                  <div><strong class="strong">Active : </strong>{{userData.activeFlag=='Y' ? 'Yes' : 'No'}}</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </app-card>

    <app-card>
      <div class="row">
        <div class="col-sm-6">
          <div class="page-header-title">
            <div class="d-inline">
              <h4 class="strong">User Mapping</h4>
            </div>
          </div>
        </div>
        <div class="col-sm-6" style="text-align: right;">
          <a container="body" *ngIf="!this.showUserMapping" href="javascript:;"
            (click)="loadUserMappedModules(userData.id);this.showUserMapping = !this.showUserMapping"
            class="crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Expand">
            <i style="font-size: 25px;color: black;" class="icofont icofont-circled-down"></i>
          </a>
          <a container="body" *ngIf="this.showUserMapping" href="javascript:;"
            (click)="this.showUserMapping = !this.showUserMapping" class="crm-action-edit text-muted text-primary"
            placement="top" ngbTooltip="Hide">
            <i style="font-size: 25px;color: black;" class="icofont icofont-circled-up"></i>
          </a>
        </div>
      </div>
      <div class="m-t-10" *ngIf="this.showUserMapping && userMappedModules">
        <label>This User is mapped to the below Documents :</label>
        <div *ngIf="userMappedModules.projectSpecific.length>0">
          <div class="row m-b-10">
            <div class="col-sm-6"><strong class="strong">Projects</strong></div>
            <div class="col-sm-6 text-right">
              <a href="javascript:" *ngIf="this.showUserMapping && projItemSelected" class="m-r-20"
                (click)="projectRoleTrasferModal.show();"><img class="image-radius rounded-0 img-30"
                  src="assets/icon/png-icons/role-transfer.png" alt="Role Transfer" placement="top"
                  ngbTooltip="Role Transfer"></a>
            </div>
          </div>
          <ngx-datatable #myTable class="data-table dt-chk" [rows]='userMappedModules.projectSpecific'
            [columnMode]="'force'" [headerHeight]="50" [rowHeight]="'auto'">
            <ngx-datatable-column name="Select" [width]="50" [sortable]="false" [canAutoResize]="false"
              [draggable]="false" [resizeable]="false">
              <ng-template class="datatable-checkbox" ngx-datatable-header-template let-row="row">
                <div class="checkbox-fade fade-in-primary datatable-header-cell-label">
                  <label container="body" placement="right" triggers="mouseenter:mouseleave" ngbPopover="Select All">
                    <input type="checkbox" [checked]="projSelectAll" (click)="onClickProjSelectAll($event);" />
                    <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                  </label>
                </div>
              </ng-template>
              <ng-template class="datatable-checkbox" ngx-datatable-cell-template let-row="row"
                let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
                <div class="checkbox-fade fade-in-primary">
                  <label>
                    <input type="checkbox" name="{{row['documentName']}}" [checked]="row.checked"
                      (change)="row.checked=!row.checked; onClickProjSelect();" />
                    <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                  </label>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column style="font-weight: bold;" name="Project Name" [sortable]="false">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['projectName']}}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column style="font-weight: bold;" name="Module Name" [sortable]="false">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['moduleName']}}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column style="font-weight: bold;" name="Document/Item Name" [sortable]="false">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['documentName']}}</strong>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>

        <div class="m-t-20" *ngIf="userMappedModules.organizationSpecific.length>0">
          <div class="row m-b-10">
            <div class="col-sm-6"><strong class="strong">Organization</strong></div>
            <div class="col-sm-6 text-right">
              <a href="javascript:" *ngIf="this.showUserMapping && orgItemSelected" class="m-r-20"
                (click)="organizationRoleTrasferModal.show();"><img class="image-radius rounded-0 img-30"
                  src="assets/icon/png-icons/role-transfer.png" alt="Role Transfer" placement="top"
                  ngbTooltip="Role Transfer"></a>
            </div>
          </div>
          <ngx-datatable #myTable class="data-table dt-chk" [rows]='userMappedModules.organizationSpecific'
            [columnMode]="'force'" [headerHeight]="50" [rowHeight]="'auto'">
            <ngx-datatable-column name="Select" [width]="50" [sortable]="false" [canAutoResize]="false"
              [draggable]="false" [resizeable]="false">
              <ng-template class="datatable-checkbox" ngx-datatable-header-template let-row="row">
                <div *ngIf="userMappedModules.organizationSpecific.length>0"
                  class="checkbox-fade fade-in-primary datatable-header-cell-label">
                  <label container="body" placement="right" triggers="mouseenter:mouseleave" ngbPopover="Select All">
                    <input type="checkbox" [checked]="orgSelectAll" (click)="onClickOrgSelectAll($event);" />
                    <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                  </label>
                </div>
              </ng-template>
              <ng-template class="datatable-checkbox" ngx-datatable-cell-template let-row="row"
                let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
                <div class="checkbox-fade fade-in-primary">
                  <label>
                    <input type="checkbox" name="{{row['documentName']}}" [checked]="row.checked"
                      (change)="row.checked=!row.checked; onClickOrgSelect();" />
                    <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                  </label>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column style="font-weight: bold;" name="Module Name" [sortable]="false">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['moduleName']}}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column style="font-weight: bold;" name="Document/Item Name" [sortable]="false">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['documentName']}}</strong>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
    </app-card>

    <app-individual-audit-trail [permission]="this.helper.USER_MANAGEMENT" [id]="userData.id">
    </app-individual-audit-trail>
  </div>
</div>

<app-modal-basic #bulkUserModal [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Bulk Import User Excel </h4>
    <button type="button" class="close basic-close" (click)="bulkUserModal.hide();closeBulkUserModel()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body" slimScroll railVisible="true" railColor="#004a6d" width="100%" height="400px" size="12px"
    color="#737373" opacity="0.6" allowPageScroll="false">
    <div class="row">
      <div class="col-sm-12">
        <div><button class="btn btn-primary" (click)="sampleUserDownload();" style="float: right;"><i
              class="icofont icofont-download-alt"></i>Sample Download</button></div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div class="sub-title">Single File</div>
        <label class="custom-file">
          <input #myInput type="file" ng2FileSelect accept=".xls" (change)="extractFile($event);">
          <span class="custom-file-control"></span>
        </label>
      </div>
    </div>
    <br>
    <div class="col-sm-12">
      <div>
        <div style="color: darkgreen" *ngIf="this.validationMessage!=''&&this.excelData.length!=0">
          {{this.validationMessage}}</div>
        <div style="color: red" *ngIf="this.validationMessage!=''&&this.excelData.length==0">{{this.validationMessage}}
        </div>
      </div>
    </div>
    <ng-container *ngIf="this.isUploaded">
      <div class="table-responsive ">
        <table id="tableIdDivRefresh1" #tableIdDivRefresh class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>User Name</th>
              <th>Email</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Mobile Number</th>
              <th>Designation</th>
              <th>Location</th>
              <th>Department</th>
              <th>Manager</th>
              <th>HOD</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody *ngFor="let row of excelData; let i = index;" [attr.data-index]="i" id="field-spacing">
            <tr>
              <td>
                <label>{{i+1}}</label>
              </td>
              <td>
                <input name="userName-{{i}}" type="text" [(ngModel)]="row.userName" class="form-control"
                  (ngModelChange)="checkUserName(excelData,row)"
                  [ngStyle]="{'background-color': (row.userName == '' || row.userNameValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.userNameValMsg != ''">{{row.userNameValMsg}}</div>
              </td>
              <td>
                <input name="email-{{i}}" type="text" [(ngModel)]="row.email" placeholder="ex- abc@abc.com"
                  [pattern]="helper.email_pattern" class="form-control" (ngModelChange)="checkEmail(excelData,row)"
                  #emails="ngModel"
                  [ngStyle]="{'background-color': (emails.errors?.pattern || row.email == '' || row.emailValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.emailValMsg != ''">{{row.emailValMsg}}</div>
              </td>
              <td>
                <input name="firstName-{{i}}" type="text" [(ngModel)]="row.firstName" class="form-control"
                  (ngModelChange)="checkFirstName(excelData,row)"
                  [ngStyle]="{'background-color': (row.firstName == '' || row.firstNameValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.firstNameValMsg != ''">{{row.firstNameValMsg}}</div>
              </td>
              <td>
                <input name="lastName-{{i}}" type="text" [(ngModel)]="row.lastName" class="form-control"
                  (ngModelChange)="checkLastName(excelData,row)"
                  [ngStyle]="{'background-color': (row.lastName == '' || row.lastNameValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.lastNameValMsg != ''">{{row.lastNameValMsg}}</div>
              </td>
              <td>
                <input name="phoneNo-{{i}}" type="text" [(ngModel)]="row.phoneNo" placeholder="xxx-xx-xxxx"
                  class="form-control" />
                <!-- <input name="phoneNo-{{i}}" type="text" [(ngModel)]="row.phoneNo" placeholder="xxx-xx-xxxx" #mobile="ngModel"
              pattern="^[6789]\d{9}$" minlength="10" maxlength="10" class="form-control" (ngModelChange)="checkPhoneNo(excelData,row)"
                [ngStyle]="{'background-color': (mobile.errors?.pattern || row.phoneNo == '' || row.phoneValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.phoneValMsg != ''">{{row.phoneValMsg}}</div> -->
              </td>
              <td>
                <input name="designation-{{i}}" type="text" [(ngModel)]="row.designation" class="form-control" />
              </td>
              <td>
                <select name="lovationIdName-{{i}}" class="form-control" [(ngModel)]="row.locationId"
                  [ngStyle]="{'background-color':(row.locationId && row.locationId!=0) ? 'white' : '#FD3A4A'}"
                  (ngModelChange)="checkLoc(excelData,row); loadDepartmentOnLocation(row)">
                  <option value="">Select Location</option>
                  <option *ngFor="let location of locationsList" [value]="location.id">{{location.name}}</option>
                </select>
                <div class="messages text-danger" *ngIf="row.locValMsg != ''">{{row.locValMsg}}</div>
              </td>
              <td>
                <select name="departmentIdName-{{i}}" class="form-control" [(ngModel)]="row.departmentId"
                  [ngStyle]="{'background-color':(row.departmentId && row.departmentId!=0) ? 'white' : '#FD3A4A'}"
                  (ngModelChange)="checkDept(excelData,row)">
                  <option value="">Select department</option>
                  <option *ngFor="let department of row.departmentList" [value]="department.id">{{department.value}}
                  </option>
                </select>
                <div class="messages text-danger" *ngIf="row.deptValMsg != ''">{{row.deptValMsg}}</div>
              </td>
              <td>
                <select name="managerName-{{i}}" class="form-control" [(ngModel)]="row.managerId">
                  <option value="">Select Manager</option>
                  <option *ngFor="let user of managerList" [value]="user.key">{{user.value}}</option>
                </select>
              </td>
              <td>
                <label class="switch">
                  <input type="checkbox" name="hodFlag-{{i}}" [(ngModel)]="row.hodFlag" />
                  <span class="slider round"></span>
                </label>
              </td>
              <td>
                <select name="roleName-{{i}}" class="form-control" [(ngModel)]="row.role"
                  [ngStyle]="{'background-color':(row.role && row.role!=0) ?  'white' : '#FD3A4A'}"
                  (ngModelChange)="checkRole(excelData,row)">
                  <option value="">Select Role</option>
                  <option *ngFor="let role of roles" [value]="role.code">{{role.value}}</option>
                </select>
                <div class="messages text-danger" *ngIf="row.roleValMsg != ''">{{row.roleValMsg}}</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div style="text-align: center" class="messages text-danger" *ngIf="this.enableImportButton">Please Fill all the
        Data</div>
      <br>
      <div class="form-group row">
        <div style="text-align: center">
          <button type="button" class="btn btn-success"
            [disabled]="!permisionModal.createButtonFlag || this.enableImportButton" (click)="importData()">Import
          </button>
          <p *ngIf="!permisionModal.createButtonFlag"
            style="color: red; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">You don't have
            create permission, please contact admin..!</p>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect"
      (click)="bulkUserModal.hide();closeBulkUserModel()">Close</button>
  </div>
</app-modal-basic>

<div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>

<app-modal-basic #bulkAddUserByAD [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Bulk Import User from AD </h4>
    <button type="button" class="close basic-close" (click)="closeBulkAddUserByADModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body dy-width-500">
    <div class="row">
      <div class="col-sm-10">
        <label class="strong">User Ids / Email Id of AD</label>
        <tag-input [(ngModel)]='adUserIds' theme='bootstrap'></tag-input>
      </div>
      <div class="col-sm-2 p-4">
        <input type="button" class="btn btn-sm btn-primary  waves-effect waves-light m-r-10" value="Get Users"
          (click)="loadUsersFromAD(adUserIds)" />
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-sm-12">
        <label class="messages text-danger"><label [innerHtml]="validationMessage"></label></label>
      </div>
    </div>
    <br>
    <ng-container *ngIf="this.aDUsersList.length>0">
      <div class="table-responsive ">
        <table id="tableIdDivRefresh1" #tableIdDivRefresh class="table table-striped table-bordered ">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>User Name <span class="asterisk">*</span></th>
              <th>First Name <span class="asterisk">*</span></th>
              <th>Last Name <span class="asterisk">*</span></th>
              <th>Designation</th>
              <th>Email <span class="asterisk">*</span></th>
              <th>Mobile Number</th>
              <th>Location <span class="asterisk">*</span></th>
              <th>Department <span class="asterisk">*</span></th>
              <th>Role <span class="asterisk">*</span></th>
            </tr>
          </thead>
          <tbody *ngFor="let row of aDUsersList ; let i = index" [attr.data-index]="i">
            <tr>
              <td>
                <label>{{i+1}}</label>
              </td>
              <td>
                <input name="userName-{{i}}" type="text" [(ngModel)]="row.userName" class="form-control"
                  (ngModelChange)="checkUserName(aDUsersList,row)"
                  [ngStyle]="{'background-color': (!row.userName || row.userNameValMsg) ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.userNameValMsg != ''">{{row.userNameValMsg}}</div>
              </td>
              <td>
                <input name="firstName-{{i}}" type="text" [(ngModel)]="row.firstName" class="form-control"
                  (ngModelChange)="checkFirstName(aDUsersList,row)"
                  [ngStyle]="{'background-color': (!row.firstName || row.firstNameValMsg) ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.firstNameValMsg">{{row.firstNameValMsg}}</div>
              </td>
              <td>
                <input name="lastName-{{i}}" type="text" [(ngModel)]="row.lastName" class="form-control"
                  (ngModelChange)="checkLastName(aDUsersList,row)"
                  [ngStyle]="{'background-color': (row.lastName == '' || row.lastNameValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.lastNameValMsg != ''">{{row.lastNameValMsg}}</div>
              </td>
              <td>
                <input name="designation-{{i}}" type="text" maxlength="49" [(ngModel)]="row.designation"
                  class="form-control" />
              </td>
              <td>
                <input name="email-{{i}}" type="text" [(ngModel)]="row.email" placeholder="ex- abc@abc.com"
                  [pattern]="helper.email_pattern" class="form-control" (ngModelChange)="checkEmail(aDUsersList,row)"
                  #emails="ngModel"
                  [ngStyle]="{'background-color': (emails.errors?.pattern || row.email == '' || row.emailValMsg != '') ? '#FD3A4A' : 'white'}" />
                <div class="messages text-danger" *ngIf="row.emailValMsg">{{row.emailValMsg}}</div>
              </td>
              <td>
                <input name="phoneNo-{{i}}" type="text" [(ngModel)]="row.phoneNo" placeholder="xxx-xx-xxxx"
                  class="form-control" />
                <!-- <input name="phoneNo-{{i}}" type="text" [(ngModel)]="row.phoneNo" placeholder="xxx-xx-xxxx"
                  #mobile="ngModel" pattern="^[6789]\d{9}$" minlength="10" maxlength="10" class="form-control" /> -->
              </td>
              <td>
                <select name="lovationIdName-{{i}}" class="form-control" [(ngModel)]="row.locationId"
                  [ngStyle]="{'background-color':(row.locationId && row.locationId!=0) ? 'white' : '#FD3A4A'}"
                  (ngModelChange)="checkLoc(excelData,row); loadDepartmentOnLocation(row)">
                  <option value="">Select Location</option>
                  <option *ngFor="let location of locationsList" [value]="location.id">{{location.name}}</option>
                </select>
                <div class="messages text-danger" *ngIf="row.locValMsg != ''">{{row.locValMsg}}</div>
              </td>
              <td>
                <select name="departmentIdName-{{i}}" class="form-control" [(ngModel)]="row.departmentId"
                  [ngStyle]="{'background-color':(row.departmentId && row.departmentId!=0) ? 'white' : '#FD3A4A'}"
                  (ngModelChange)="checkDept(aDUsersList,row)">
                  <option value="">Select department</option>
                  <option *ngFor="let department of departmentList" [value]="department.id">{{department.value}}
                  </option>
                </select>
                <div class="messages text-danger" *ngIf="row.deptValMsg">{{row.deptValMsg}}</div>
              </td>
              <td>
                <select name="roleName-{{i}}" class="form-control" [(ngModel)]="row.role"
                  [ngStyle]="{'background-color':(row.role && row.role!=0) != '' ? 'white' : '#FD3A4A'}"
                  (ngModelChange)="checkRole(aDUsersList,row)">
                  <option value="">Select Role</option>
                  <option *ngFor="let role of roles" [value]="role.code">{{role.value}}</option>
                </select>
                <div class="messages text-danger" *ngIf="row.roleValMsg">{{row.roleValMsg}}</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div style="text-align: center" class="messages text-danger" *ngIf="this.enableImportButton">Please Fill all the
        mandatory
        Data</div>
      <br>
      <div class="form-group row">
        <div style="text-align: center">
          <button type="button" class="btn btn-success"
            [disabled]="!permisionModal.createButtonFlag || this.enableImportButton"
            (click)="saveBulkAddUserByADModal()">Import
          </button>
          <p *ngIf="!permisionModal.createButtonFlag"
            style="color: red; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">You don't have
            create permission, please contact admin..!</p>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect" (click)="closeBulkAddUserByADModal()">Close</button>
  </div>
</app-modal-basic>

<app-modal-basic #alertMessage>
  <div class="app-modal-header">
    <h4 class="modal-title">Please check!</h4>
  </div>
  <div class="app-modal-body" style="max-height: 400px; overflow-y: scroll;">
    <label>This User is mapped in the below Documents: </label>
    <br>
    <table class="table table-bordered w-100">
      <thead>
        <tr class="lightGary">
          <th>Project Name</th>
          <th>Document Name</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of this.moduleNames;let i = index">
          <td>{{row.key}}</td>
          <td>{{row.value}}</td>
        </tr>
      </tbody>
    </table>
    <br>
    <label>Kindly release User from above mentioned Documents to proceed further.</label>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect " (click)="alertMessage.hide()">OK</button>
  </div>
</app-modal-basic>

<app-modal-basic #projectRoleTrasferModal [hideHeader]="true" [hideFooter]="true" [dialogClass]="'modal-md'">
  <div class="app-modal-body">
    <button type="button" class="close basic-close-light-box"
      (click)="closeProjectRoleModal(); projectRoleTransfer.reset();">
      <span aria-hidden="true">&times;</span>
    </button>
    <h5>Role Transfer</h5><br>
    <hr>
    <div class="col-sm-12">
      <form #projectRoleTransfer="ngForm">
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="dept">Department<span class="asterisk required">*</span> :</label>
            <angular2-multiselect name="departmentName" [data]="this.deptForProjectList" id="departmentId"
              (ngModelChange)="onChangeProjectDept($event)" [(ngModel)]="deptForProject" #projDepartment="ngModel"
              required [settings]="deptDropdownSettings">
            </angular2-multiselect>
            <div class="messages text-danger"
              *ngIf="projectRoleSubmitted && (!deptForProject || deptForProject.length==0)">Department
              is required</div>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="dept">User<span class="asterisk required">*</span> :</label>
            <angular2-multiselect name="userName" [data]="this.userForProjectList" id="userId"
              [(ngModel)]="userForProject" #projUser="ngModel" required [settings]="userDropdownSettings">
            </angular2-multiselect>
            <div class="messages text-danger"
              *ngIf="projectRoleSubmitted && (!userForProject || userForProject.length==0)">User is
              required</div>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="remarks">Remarks<span class="asterisk required">*</span> :</label>
            <textarea style="width:-webkit-fill-available" name="remarks" [(ngModel)]="this.remarksForProject"
              #projRemark="ngModel" [attr.rows]="2" required></textarea>
            <div class="messages text-danger" *ngIf="projectRoleSubmitted && projRemark.errors?.required">Enter remarks
              here</div>
          </div>
        </div>
        <hr>
        <div class="col-sm-12">
          <div style="float: right;">
            <button type="button" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
              (click)="roleTransferForProjectModule(projectRoleTransfer);">Save</button>
            <button type="button" class="btn btn-sm btn-danger waves-effect waves-light"
              (click)="closeProjectRoleModal(); projectRoleTransfer.reset();">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic #organizationRoleTrasferModal [hideHeader]="true" [hideFooter]="true" [dialogClass]="'modal-md'">
  <div class="app-modal-body">
    <button type="button" class="close basic-close-light-box" (click)="closeOrgRoleModal(); orgRoleTransfer.reset();">
      <span aria-hidden="true">&times;</span>
    </button>
    <h5>Role Transfer</h5><br>
    <hr>
    <div class="col-sm-12">
      <form #orgRoleTransfer="ngForm">
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="dept">Department<span class="asterisk required">*</span> :</label>
            <angular2-multiselect name="departmentName" [data]="this.deptList" id="departmentId"
              (ngModelChange)="onChangeOrgDept($event)" [(ngModel)]="deptForOrganization" #orgDepartment="ngModel"
              required [settings]="deptDropdownSettings">
            </angular2-multiselect>
            <div class="messages text-danger"
              *ngIf="orgRoleSubmitted && (!deptForOrganization || deptForOrganization.length==0)">Department
              is required</div>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="dept">User<span class="asterisk required">*</span> :</label>
            <angular2-multiselect name="userName" [data]="this.userForOrganizationList" id="userId"
              [(ngModel)]="userForOrganization" #orgUser="ngModel" required [settings]="userDropdownSettings">
            </angular2-multiselect>
            <div class="messages text-danger"
              *ngIf="orgRoleSubmitted && (!userForOrganization || userForOrganization.length==0)">User is
              required
            </div>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <label for="remarks">Remarks<span class="asterisk required">*</span> :</label>
            <textarea style="width:-webkit-fill-available" name="remarks" [(ngModel)]="this.remarksForOrganization"
              #orgRemarks="ngModel" [attr.rows]="2" required></textarea>
            <div class="messages text-danger" *ngIf="orgRoleSubmitted && orgRemarks.errors?.required">Enter remarks here
            </div>
          </div>
        </div>
        <hr>
        <div class="col-sm-12">
          <div style="float: right;">
            <button type="button" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
              (click)="roleTransferForOrgModule(orgRoleTransfer);">Save</button>
            <button type="button" class="btn btn-sm btn-danger waves-effect waves-light"
              (click)="closeOrgRoleModal(); orgRoleTransfer.reset();">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic #roleTransferAlertMessage>
  <div class="app-modal-header">
    <h4 class="modal-title">Please check!</h4>
  </div>
  <div class="app-modal-body" style="max-height: 400px; overflow-y: scroll;">
    <label>Role transfer to {{this.failureRoleUserName}} is failed for below items</label>
    <br>
    <table class="table table-bordered w-100">
      <thead>
        <tr class="lightGary">
          <th>Project Name</th>
          <th>Module Name</th>
          <th>Document/Item Name</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of this.failureRoleModuleList;let i = index">
          <td>{{row.projectName ? row.projectName : 'N/A'}}</td>
          <td>{{row.moduleName}}</td>
          <td>{{row.documentName}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect" (click)="roleTransferAlertMessage.hide();">OK</button>
  </div>
</app-modal-basic>