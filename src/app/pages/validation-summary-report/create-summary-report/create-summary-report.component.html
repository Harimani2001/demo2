<div class="col-sm-12" *ngIf="showView" id="float-action">
  <app-card>
    <div class="row">
      <div class="page-header-title col-sm-4">
        <i class="icofont icofont-file-alt bg-c-orenge"></i>
        <div class="d-inline">
          <h4>Validation Summary Report</h4>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="row" *ngIf="modal.id!=0">
          <div class="col-sm-6">
            Validation status:
            <a href="javascript:" (click)="onClickProjectStatusModal();">
              {{projectModal.validationStatus}}
            </a>
          </div>
          <div class="col-sm-6">
            System status :
          <a href="javascript:" (click)="onClickProjectStatusModal();">
            {{projectModal.systemStatus}}
          </a>
          </div>
        </div>
      </div>
      <div class="col-sm-4 text-right">
        <span style="display: inline-flex;">
          <span *ngIf="this.projectChecklistStatus !=''">
            <span> <span style="background-color: yellow;">Checklist</span> : 
            <a href="javascript:void(0)" (click)="onClickChecklistStatus()">{{this.projectChecklistStatus}}</a></span>
            <div style="display: flex;">
              <div style="font-size: 11px;padding-right: 3px;margin-top: -7px;">{{projectChecklistPercentage}}%</div>
              <div>
                <div class="progress" style="width: 90px;height: 8px;">
                  <div class="progress-bar" [style.width]="projectChecklistPercentage + '%'"></div>
                </div>
              </div>
            </div>
          </span>
          &nbsp;&nbsp;
          <h4 *ngIf="publishedFlag" >Published <i class="text-success icofont icofont-check-circled"></i> &nbsp;&nbsp;</h4>
          <a *ngIf="permissionModal.userInWorkFlow" href="javascript:"><img class="image-radius rounded-0 img-25 m-r-10"
            src="assets/icon/png-icons/menu.png" alt="Table of Content" placement="bottom" ngbTooltip="Table of Content"
            (click)="onClickTableOfContent()"></a>
            <a *ngIf="publishedFlag" href="javascript:" class="m-r-10"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/pdfDownload.svg"
              alt="PDF Download" placement="bottom" ngbTooltip="PDF Download" (click)="pdfdownload();"></a>
        </span>
        <button *ngIf="editButtonFlag && !publishedFlag" type="button"
        class="btn btn-sm btn-success waves-effect waves-light m-r-10" (click)="editReport()">Edit</button>
        <button *ngIf="!publishedFlag && this.permissionModal.publishButtonFlag" type="button"
        [disabled]="!isProjectChecklistStatus" class="btn btn-sm btn-warning  waves-effect waves-light m-r-10" (click)="publishData();">Publish
        </button>
        <div *ngIf="!this.permissionModal.publishButtonFlag" class="messages text-danger">Note* : You are not in workflow. Please contact admin!. </div>
        <div *ngIf="!isProjectChecklistStatus" class="messages text-danger">Note* : Checklist should be 100% completed for publishing VSR!. </div>
      </div>
    </div>
  </app-card>
</div>
<div><br><br><br><br></div>

<form-wizard id="vsr-form-wizard" #formWizard *ngIf="showCreation" (onStepChanged)="onStepChange($event)">
  <div class="col-sm-12" *ngIf="showCreation" id="float-action">
    <app-card>
      <div class="page-header-title">
        <i class="icofont icofont-file-alt bg-c-orenge"></i>
        <div class="d-inline">
          <h4>Validation Summary Report</h4>
        </div>
      </div>
      <div class="d-inline">
        <div style="float: right;">
          <a href="javascript:;" class="strong align-middle"
            (click)="urlchecklist.show();this.referenceFlag=!this.referenceFlag" placement="bottom"
            ngbTooltip="Reference"><i class="icofont icofont-link m-r-10"></i></a>
          <a *ngIf="permissionModal.userInWorkFlow" href="javascript:"><img class="image-radius rounded-0 img-25 m-r-10"
            src="assets/icon/png-icons/menu.png" alt="Table of Content" placement="bottom" ngbTooltip="Table of Content"
            (click)="onClickTableOfContent()"></a>
          <button *ngIf="this.title!='Step 1'" type="button"
            class="btn btn-sm btn-secondary waves-effect waves-light m-r-10"
            (click)="navigatePrevious()">Previous</button>
          <button *ngIf="this.title!=(inputField.length==0?'Step 3':'Step 4')" type="button"
            class="btn btn-sm btn-secondary waves-effect waves-light m-r-10" (click)="navigateNext()">Next</button>
          <button *ngIf="this.title!='Step 1' && updateButtonFlag && this.permissionModal.updateButtonFlag"
            type="button" class="btn btn-primary" (click)="openSuccessUpdateSwal(step1.valid,step2.valid)"
            class="btn btn-sm btn-success waves-effect waves-light m-r-10">
            Update</button>
          <button
            *ngIf="this.title!='Step 1' && (!publishedFlag && this.isAllDocLocked) && this.permissionModal.publishButtonFlag"
            type="button" class="btn btn-primary" (click)="publishData()" [disabled]="!isProjectChecklistStatus"
            class="btn btn-sm btn-warning  waves-effect waves-light m-r-10">
            Publish </button>
          <button *ngIf="this.title!='Step 1' && saveButtonFlag && this.permissionModal.createButtonFlag" type="button"
            class="btn btn-success" (click)="onsubmit(step1.valid,step2.valid)"
            class="btn btn-sm btn-success waves-effect waves-light m-r-10">
            Save</button>
          <button *ngIf="this.title!='Step 1'" type="button"
            class="btn btn-sm btn-danger waves-effect waves-light m-r-10" 
            (click)="ngOnInit()">
            Cancel</button>
        </div>
      </div>
    </app-card>
  </div>

  <wizard-step #wizardStep [title]="'Step 1'" [showNext]="false">
    <app-card style="width: 100%;">
      <div>
        <ngx-datatable #myTable id="summaryCustomTable" class="data-table dt-chk" [headerHeight]="50" [footerHeight]="0"
          [rows]='filteredDocumentSummaryList' [columnMode]="'force'" [rowHeight]="'auto'">

          <ngx-datatable-row-detail [rowHeight]="'auto'">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
              <app-card>
                <ng-container *ngIf="row.projectPlan.length > 0">
                  <div class="dot approved col-sm-8"><label class="imageSize"><i
                        class="icofont icofont-law-document"></i></label><strong>Plan</strong>
                  </div>
                  <div style="overflow-x: scroll;">
                    <table cellpadding="5" id="projectSummary">
                      <thead>
                        <tr class="lightGary">
                          <th>Level Name</th>
                          <th>Target Start Date</th>
                          <th>Target End Date</th>
                          <th>Actual Start Date</th>
                          <th>Actual End Date</th>
                          <th>AssignedTo</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let level of row.projectPlan">
                          <td>{{level.itemName}}</td>
                          <td>{{level.startTargetDate}}</td>
                          <td>{{level.endTargetDate}}</td>
                          <td>{{level.actualStartTargetDate|date:this.datePipeFormat}}</td>
                          <td>{{level.actualEndTargetDate|date:this.datePipeFormat}}</td>
                          <td style="width:max-content;">
                            <span *ngFor="let user of level.selectedUsers">{{user.itemName}}<br></span>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </ng-container>

                <ng-container
                  *ngIf="row.testCaseCount.length && (row.documentType == '108' || row.documentType == '109' || row.documentType == '110' || row.documentType == '207' || row.documentType == '208')">
                  <div class="row">
                    <div class="dot total col-sm-8"><label class="imageSize"><i
                          class="icofont icofont-prescription"></i></label>
                      <Strong>Test Case</Strong>
                    </div>
                  </div>
                  <ng-container *ngFor="let testCase of row.testCaseCount">
                    <div class="row">
                      <div class="col-sm-3"><span><strong class="strong">Test Run: &nbsp;</strong>
                          {{testCase.testRunName}} </span></div>
                          <div class="col-sm-2"><span> <strong class="strong">Total&nbsp;</strong>
                            {{testCase.total}}</span></div>
                          <div class="col-sm-2"><span> <strong class="strong">Workflow InProgress&nbsp;</strong>
                            {{testCase.incompleted}}</span></div>
                      <div class="col-sm-2"><span><strong class="strong">Workflow Completed
                            &nbsp;</strong>{{testCase.completed}}</span></div>
                    </div>
                    <table cellpadding="5" id="projectSummary" style="width: 55%;">
                      <thead>
                        <tr class="lightGary">
                          <th>No Run</th>
                          <th>In Progress</th>
                          <th>Pass</th>
                          <th>Fail</th>
                          <th>N/A</th>
                          <th>DF</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>{{testCase.runCount}}</td>
                          <td>{{testCase.testCaseInProgressCount}}</td>
                          <td>{{testCase.passCount}}</td>
                          <td>{{testCase.failCount}}</td>
                          <td>{{testCase.nACount}}</td>
                          <td>{{testCase.discrepancyCount}}</td>
                        </tr>
                      </tbody>
                    </table>
                    <br>
                  </ng-container>
                </ng-container>

                <ng-container *ngIf="row.expectedStartDate!=null">
                  <div class="row ">
                    <h4 class="strong">Plan</h4>
                  </div>
                  <div class="row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-4"><label class="strong">Start date</label></div>
                    <div class="col-sm-4"> <label class="strong">End date</label></div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4"> <label class="strong"><i
                          class="icofont icofont-ui-calendar"></i>Expected</label></div>
                    <div class="col-sm-4"> {{row.expectedStartDate | date: 'yyyy-MM-dd'}}</div>
                    <div class="col-sm-4">{{row.expectedEndDate | date: 'yyyy-MM-dd'}}</div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4"> <label class="strong"><i
                          class="icofont icofont-ui-calendar"></i>Actual</label></div>
                    <div class="col-sm-4"> {{row.actualStartDate | date: 'yyyy-MM-dd'}}</div>
                    <div class="col-sm-4">{{row.actualEndDate | date: 'yyyy-MM-dd'}}</div>
                  </div>
                </ng-container>

              </app-card>
            </ng-template>
          </ngx-datatable-row-detail>

          <ngx-datatable-column [width]="30" [cellClass]="'bg-white'" [sortable]="false" [draggable]="false"
            [canAutoResize]="false">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
              <a *ngIf="row.projectPlan.length > 0 || row.testCaseCount.length > 0 || row.expectedStartDate!=null"
                href="javascript:;" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded"
                title="Expand/Collapse Row" (click)="toggleExpandRow(row)"></a>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="400" [sortable]="false" name="Document">
            <ng-template let-row="row" let-rowIndex="rowIndex" ngx-datatable-cell-template>
              <div class="page-header-title">
                <i class="icofont icofont-file-document bg-c-blue"
                  style="font-size: 15px; height: 30px; width: 30px;"></i>
                <div class="d-inline p-t-10">
                  <a container="body" (click)="urlRedirect(row.documentUrl)">
                    <strong style="cursor: pointer;">{{row.documentName}}</strong>
                  </a>
                </div>
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="170" [cellClass]="'bg-white'" [sortable]="false" name="Draft">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div class="text-center text-warning" (click)="goToDetails(row.documentType, 'draft', row.draft)">
                {{row.draft}}
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="170" [cellClass]="'bg-white'" [sortable]="false" name="Published">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div class="text-center deepPink" (click)="goToDetails(row.documentType, 'published', row.published)">
                {{row.published}}
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="170" [cellClass]="'bg-white'" [sortable]="false" name="In Progress">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <ng-container
                *ngIf="!(row.documentType == '108' || row.documentType == '109' || row.documentType == '110' || row.documentType == '207' || row.documentType == '208')">
                <div class="text-center blue" (click)="goToDetails(row.documentType, 'inProgress', row.inProgress)">
                  {{row.inProgress}}
                </div>
              </ng-container>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="170" [cellClass]="'bg-white'" [sortable]="false" name="Completed">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <ng-container
                *ngIf="!(row.documentType == '108' || row.documentType == '109' || row.documentType == '110' || row.documentType == '207' || row.documentType == '208')">
                <div class="text-center green" (click)="goToDetails(row.documentType, 'completed', row.completed)">
                  {{row.completed}}
                </div>
              </ng-container>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column *ngIf="!showColumn" [width]="170" [cellClass]="'bg-white'" [sortable]="false"
            name="Progress Status">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <ng-container
                *ngIf="!(row.documentType == '108' || row.documentType == '109' || row.documentType == '110' || row.documentType == '207' || row.documentType == '208')">
                {{calculatePercentage(row.published, row.completed)}}
                <div style="width:100%;">
                  <div class="row">
                    <div class="col-sm-9">
                      <div style="font-size: 60%;text-align:end;">{{this.percentage}}%</div>
                      <div class="progress" style="height: 0.5em !important;">
                        <div class={{this.progressBarColour}} role="progressbar" aria-valuenow=this.percentage
                          aria-valuemin="0" aria-valuemax="100" [style.width]="this.percentage + '%'">
                        </div>
                      </div>
                    </div>
                    <div *ngIf="getPercentage(row.published, row.completed)" class="col-sm-3"
                      style="margin-left: -10px;"><i class="icofont icofont-tick-mark text-success"></i></div>
                  </div>
                </div>
              </ng-container>

            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [width]="280" [cellClass]="'bg-white'" [sortable]="false" name="Action">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <ng-template #popContent>
                <span>
                  <ng-container *ngIf="row.documentNumber">
                    <div>Document Number:<br>{{row.documentNumber}}</div><br>
                  </ng-container>
                  <div>Last updated by:<br>{{row.lastUpdatedBy}}</div><br>
                  <div>Last updated time:<br>{{row.lastUpdatedTime}}</div>
                </span>
              </ng-template>
              <a container="body" href="javascript:;" class="m-r-15 crm-action-info text-muted" placement="right"
                placement="top" [ngbTooltip]="popContent">
                <i class="summary-icon icofont icofont-info-square"></i>
              </a>
              <a container="body" href="javascript:;" placement="top" class="m-r-15 crm-action-view text-muted "
                (click)="loadStepperData(row); modalLargeWorkFlowProjectSummary.show();" ngbTooltip="Workflow">
                <i class="summary-icon icofont icofont-chart-flow-alt-1"></i>
              </a>
              <a container="body" href="javascript:;" placement="top" class="m-r-15 crm-action-view text-muted"
                (click)="loadWorkflowUsers(row.documentType); shareGraphEmail.show()" ngbTooltip="Share">
                <i class="summary-icon icofont icofont-share-alt"></i>
              </a>
              <a container="body" href="javascript:;" placement="top" class="m-r-15 crm-action-view text-muted"
                (click)="urlRedirect(row.documentUrl)" ngbTooltip="View Document">
                <i class="summary-icon icofont icofont-eye-alt"></i>
              </a>
              <a container="body" href="javascript:;" placement="top" class="m-r-15 crm-action-view text-muted"
                (click)="downloadPdf(row.documentType,row.documentName)" ngbTooltip="Download PDF">
                <i class="icofont icofont-download summary-icon"></i>
              </a>
              <a container="body" href="javascript:;" placement="top"
                class="m-r-15 crm-action-view text-muted text-warning"
                (click)="checkdocumentIslockOrNot(row.documentType)" ngbTooltip="Document Freeze">
                <i
                  class="{{row.freezeFlagIcon ? 'icofont summary-icon icofont-unlock' : 'icofont summary-icon icofont-unlocked'}}"></i>
              </a>
            </ng-template>
          </ngx-datatable-column>

        </ngx-datatable>
      </div>
    </app-card>
  </wizard-step>

  <wizard-step #wizardStep [title]="'Step 2'" [showNext]="false">
    <br>
    <div class="row">
      <div class="col-sm-12">
        <form #step1="ngForm">
          <table id="add-table" class="table w-100">
            <tbody>
              <tr>
                <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">Objective & Purpose<span class="asterisk required">*</span> :</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.objectiveAndPurpose"  rows="3" name="objectiveAndPurpose" #objectiveAndPurpose="ngModel"
                        required></textarea>
                      <div class="messages text-danger"
                        *ngIf="(objectiveAndPurpose.touched || submitted) && objectiveAndPurpose.errors?.required">
                        Objective is required</div>
                    </div>
                  </div>
                </td>

                <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">Scope :</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.scope"  rows="3"
                        name="scope" #scope="ngModel"></textarea>
                    </div>
                  </div>
                </td>
              </tr>

              <tr>
                <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">Validation Summary:</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.validationSummary" 
                        rows="3" name="validationSummary" #validationSummary="ngModel"></textarea>
                    </div>
                  </div>
                </td>

                <!-- <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">Validation Deliverables :</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.validationDeliverable"
                        maxlength="300" rows="3" name="validationDeliverables"
                        #validationDeliverables="ngModel"></textarea>
                    </div>
                  </div>
                </td> -->

                <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">Risk Assessment :</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.riskAssessment" 
                        rows="3" name="riskAssessment" #riskAssessment="ngModel"></textarea>
                    </div>
                  </div>
                </td>
              </tr>

              <tr>
                <td colspan="2">
                  <div class="row">
                    <div class="col-sm-2">
                      <strong class="strong">Summary of Deviations :</strong>
                    </div>
                    <div class="col-sm-10">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.summaryOfDeviations"
                        rows="3" name="summaryOfDeviations" #summaryOfDeviations="ngModel"></textarea>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </wizard-step>

  <wizard-step [hidden]="inputField.length==0" [title]="'Step 3'" (onNext)="onStep4Next($event)" [showPrev]="flase"
    [showNext]="false">
    <br>
    <div class="row">
      <div class="col-sm-12">
        <div>
          <app-form-extended #formExtendedId [(inputField)]='inputField' [documentId]="this.helper.VSR_NAME"
            submitted='true'></app-form-extended>
        </div>
      </div>
    </div>
  </wizard-step>

  <wizard-step [title]="inputField.length==0?'Step 3':'Step 4'" [showPrev]="flase" [showNext]="false">
    <br>
    <div class="row">
      <div class="col-sm-12">
        <form #step2="ngForm">

          <table id="add-table" class="table w-100">
            <tbody>
              <tr>
                <td colspan="2">
                  <div class="row">
                    <div class="col-sm-2">
                      <strong class="strong">Observations and Recommendation :</strong>
                    </div>
                    <div class="col-sm-10">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.observationAndRecommendation"
                       rows="3" name="observationsAndRecommendation"
                        #observationsAndRecommendation="ngModel"></textarea>
                    </div>
                  </div>
                </td>

                <!-- <td>
                  <div class="row">
                    <div class="col-sm-3">
                      <strong class="strong">User Acceptance<span class="asterisk required">*</span> :</strong>
                    </div>
                    <div class="col-sm-9">
                      <textarea class="form-control max-textarea" [(ngModel)]="modal.userAcceptance" maxlength="300"
                        rows="3" name="userAcceptance" #userAcceptance="ngModel" required></textarea>
                      <div class="messages text-danger"
                        *ngIf="(userAcceptance.touched || submitted) && userAcceptance.errors?.required">User Acceptance
                        is required</div>
                    </div>
                  </div>
                </td> -->
              </tr>

              <tr>
                <td>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong class="strong">Change Control Number:</strong>
                    </div>
                    <div class="col-sm-8">
                      <label>Custom Enable
                        <ui-switch (click)="enableOfCustomCCF()" [checked]="modal.customCCFEnable" class="js-small"
                          color="#3498DB" switchColor="#fff" size="small" unchecked>
                        </ui-switch>
                      </label>
                      <input *ngIf="modal.customCCFEnable" type="text" [(ngModel)]="modal.customCCFValue"
                        class="form-control" name="customCCF" maxlength="49" placeholder="Custom Change Control Number"
                        #customCCF="ngModel" />
                      <ng-select *ngIf="!modal.customCCFEnable" [ngClass]="'ng-select'" [options]="simpleOptionCCF"
                        [multiple]="true" [(ngModel)]="modal.changeControlForms" name="ccf" rounds="ngModel"
                        #ccf="ngModel">
                      </ng-select>
                    </div>
                  </div>
                </td>

                <td>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong class="strong">Release Date:</strong>
                    </div>
                    <div class="col-sm-8">
                      <my-date-picker #relaseDateElement (keypress)="$event.preventDefault();"  name="releaseDate"
                        (click)="openReleaseBtnClicked()" placeholder="Release Date"
                        [options]="myDatePickerOptions" [(ngModel)]="releaseDate"
                        #releaseDateModal="ngModel">
                      </my-date-picker>
                    </div>
                  </div>
                </td>
              </tr>

              <tr>
                <td>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong class="strong">Is Periodic Review Required?</strong>
                    </div>
                    <div class="col-sm-8">
                      <label>
                        <ui-switch (click)="enablePeriodocReview()" [checked]="modal.periodicReviewFlag" class="js-small"
                        color="#3498DB" switchColor="#fff" size="small" unchecked>
                      </ui-switch>
                      </label>
                      <my-date-picker *ngIf="modal.periodicReviewFlag" (keypress)="$event.preventDefault();" #date name="validationExpiryDate"
                        (click)="openBtnClicked()" placeholder="Periodic review date"
                        [options]="myDatePickerOptions" [(ngModel)]="validationExpiryDate"
                        #validationExpiryDateModal="ngModel">
                      </my-date-picker>
                    </div>
                  </div>
                </td>
                <td *ngIf="modal.periodicReviewFlag">
                  <div class="row">
                    <div class="col-sm-4">
                      <strong class="strong">Is New Version Required? :</strong>
                    </div>
                    <div class="col-sm-8">
                      <label>
                        <ui-switch (click)="modal.newVersionRequiredFlag = !modal.newVersionRequiredFlag"
                          [checked]="modal.newVersionRequiredFlag" class="js-small" color="#3498DB" switchColor="#fff"
                          size="small" unchecked>
                        </ui-switch>
                      </label>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="modal.periodicReviewFlag">
            <label>Please select the documents for Periodic review </label>
            <br>
            <hr>
            <ng-container *ngFor="let row of docItemList;let i=index">
              <div class="checkbox-fade fade-in-primary">
                <label>
                  <input value="{{row['check']}}" name="{{row['name']}}" [(ngModel)]="row.check" (click)="addData(i);"
                    type="checkbox" class="form-control">
                  <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-success"></i></span>
                  <span>{{row['name']}}</span>
                </label>
              </div>
            </ng-container>
            <hr>
          </div>
          <ng-container *ngIf="selectedDocumentForPeriodic">
            <div>For Periodic Review</div>
            <hr>
            <div *ngFor="let row of docItemList;">
              <label class="label label-primary" *ngIf="row.check"> {{row.name}} </label>
            </div>
          </ng-container>
        </form>
      </div>
    </div>
  </wizard-step>

</form-wizard>

<app-card [blockClass]="'accordion-block scale-accordion'" *ngIf="showView">
  <ngb-tabset #ursTab="ngbTabset">
    <ngb-tab id="approve" title="Approve / PDF View" *ngIf="publishedFlag">
      <ng-template ngbTabContent>
        <app-individual-document-workflow [permissionConstant]="this.helper.VSR_VALUE" (onRejectDocument)="reload();"
          (onClose)="reload();"></app-individual-document-workflow>
      </ng-template>
    </ngb-tab>
    <ngb-tab id="summary" title="Summary">
      <ng-template ngbTabContent>
        <div *ngFor="let modal of viewData; let in = index">
          <squeezebox [multiple]="true">
            <sb-item [collapsed]="false" class="accordion-panel">
              <sb-item-head class="accordion-msg">Objective & Purpose</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.objectiveAndPurpose?modal.objectiveAndPurpose:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Scope</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.scope?modal.scope:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Validation Summary</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.validationSummary?modal.validationSummary:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <!-- <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Validation Deliverables</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.validationDeliverable}}</p>
                </div>
              </sb-item-body>
            </sb-item> -->
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Risk Assessment</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.riskAssessment?modal.riskAssessment:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Summary of Deviations</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.summaryOfDeviations?modal.summaryOfDeviations:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Observations and Recommendation</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.observationAndRecommendation?modal.observationAndRecommendation:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <!-- <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">User Acceptance</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.userAcceptance}}</p>
                </div>
              </sb-item-body>
            </sb-item> -->
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Change Control Number</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.customCCFValue?modal.customCCFValue:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Release Date</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.releaseDateView?modal.releaseDateView:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <sb-item class="accordion-panel" [collapsed]="false">
              <sb-item-head class="accordion-msg">Periodic Review</sb-item-head>
              <sb-item-body class="accordion-content">
                <div class="accordion-desc">
                  <p>{{modal.validationExpiryDateView?modal.validationExpiryDateView:'N/A'}}</p>
                </div>
              </sb-item-body>
            </sb-item>
            <ng-container *ngIf="selectedDocumentForPeriodic">
              <sb-item class="accordion-panel" [collapsed]="false">
                <sb-item-head class="accordion-msg">Documents for Periodic Review</sb-item-head>
                <sb-item-body class="accordion-content">
                  <div class="accordion-desc">
                    <div *ngFor="let row of docItemList;">
                      <label class="label label-primary" *ngIf="row.check"> {{row.name}}
                      </label>
                    </div>
                  </div>
                </sb-item-body>
              </sb-item>
            </ng-container>
           
          </squeezebox>
          <div *ngIf="this.viewData[0].urlChecklist && this.viewData[0].urlChecklist.length != 0" class="row ">
            <div class="col-sm-12"><strong class="strong">Reference</strong></div>
            <div class="col-sm-12">
              <table id="testcase-table-urlList" class="table">
                <thead class="panel-heading">
                  <tr class="w-100">
                    <td class="w-10"><label class="strong">S No.</label></td>
                    <td class="w-40"><label class="strong">Title</label></td>
                    <td class="w-40"><label class="strong">URL</label></td>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of this.viewData[0].urlChecklist; let i = index">
                    <td class="w-10">{{i+1}}</td>
                    <td class="w-40">{{item.title}}</td>
                    <td class="w-40"><a class="pointer btn-link text-primary"
                        (click)="this.helper.navigateExternalURL(item.url)">{{item.url}}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <app-view-form [inputField]='this.viewData'></app-view-form><br>
          <app-individual-audit-trail [permission]="this.helper.VSR_VALUE" [id]="modal.id"></app-individual-audit-trail>
        </div>
        <app-document-forum [isDocumentWorkFlow]="true" [constant]="helper.VSR_VALUE" [id]="modal.id"></app-document-forum>
      </ng-template>
    </ngb-tab>
  </ngb-tabset>
</app-card>

<div *ngIf="this.spinnerFlag" class="loading">Loading&#8230;</div>

<app-modal-basic #alertMessage>
  <div class="app-modal-header">
    <h4 class="modal-title">Please check!</h4>
  </div>
  <div class="app-modal-body">
    <label>
      The below document types has pending documents:
    </label>
    <br>
    <div *ngFor="let row of this.pendingDocs;let i = index">
      {{i+1 }} . <label class="label label-primary"> {{row}}
      </label>
    </div>
    <br>
    <label>
      Kindly complete and lock the document to proceed further.
    </label>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect " (click)="alertMessage.hide()">OK</button>
  </div>
</app-modal-basic>

<app-modal-basic #urlchecklist [hideHeader]="false" [hideFooter]="false" [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Reference</h4>
    <button type="button" class="close basic-close" (click)="closereference(modal.urlChecklist)">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body" *ngIf="this.referenceFlag">
    <app-urlchecklist #checkListURL [checkList]="modal.urlChecklist"></app-urlchecklist>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect"
      (click)="validateReference(modal.urlChecklist)">Submit</button>
    <button type="button" class="btn btn-default waves-effect"
      (click)="closereference(modal.urlChecklist)">Close</button>
  </div>
</app-modal-basic>

<app-modal-basic #modalLargeWorkFlowProjectSummary [dialogClass]="'modal-lg'" [hideClickOutSide]="true"
  class="modal-dialog modal-dialog-scrollable">
  <div class="app-modal-header">
    <h4 class="modal-title strong">Workflow Configuration of {{docName}}</h4>
    <button type="button" class="close basic-close" (click)="modalLargeWorkFlowProjectSummary.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div style="max-height: 400px !important;" class="app-modal-body">
    <div style="max-height: 300px !important;" class="col-sm slimScrollDiv">
      <div class="dt-desc dy-width-300">
        <ng-container *ngFor="let loadStepper of this.loadStepperList;">
          <h4 class="modal-title strong">{{loadStepper.docName}}</h4>
          <ul class="progress-indicator">
            <li *ngFor="let data of loadStepper.stepperList;" class="completed">
              <label>
                <span style="white-space: pre-line;" class="bubble"></span>
                <div class="strong"> {{data.levelName}} : {{data.type}}<br><br>
                  <div style="text-align: left;"><b class="black"><u>Users</u></b>
            <li *ngFor="let user of data.userArray;let i = index ">{{i+1}}.{{user}}</li>
      </div>
    </div>
    </label>
    </li>
    </ul><br><br>
    </ng-container>
  </div>
  </div>
  </div>
  <div class="app-modal-footer">
  </div>
</app-modal-basic>

<app-modal-basic #shareGraphEmail [hideHeader]="false" [hideFooter]="false" [dialogClass]="'modal-md'">
  <div class="app-modal-header">
    <button type="button" class="close basic-close-light-box" (click)="onClose();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="row">
      <div class="col-sm-12">
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">Users <span class="asterisk required">*</span></label>
          <div class="col-sm-10">
            <span>
              <angular2-multiselect name="users" [data]="userList" id="users" required #users="ngModel"
                [(ngModel)]="selectedUsersForEmail" [settings]="dropdownSettings">
              </angular2-multiselect>
              <div class="messages text-danger" *ngIf="isSubmitted && users.errors?.required">Users can't be blank</div>
            </span>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">Remarks</label>
          <div class="col-sm-10">
            <span>
              <textarea style="width:-webkit-fill-available" [(ngModel)]="graphRemarks" name="remarks"
                #remarks="ngModel" [attr.rows]="2"></textarea>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="width: 100%;" class="app-modal-footer">
    <div class="row">
      <div style="text-align: center;" class="col-sm-12">
        <button class="btn btn-success" (click)="sendGraphEmail();">Send</button>
        <button class="btn btn-danger" (click)="onClose();">Cancel</button>
      </div>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic #freezemodal [hideFooter]="true" [dialogClass]="'modal-md'">
  <div class="app-modal-header">
    <h4 class="modal-title">Revision of Document</h4>
    <button type="button" class="close basic-close-light-box" (click)="freezemodal.hide();loaddata();close();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div *ngIf="this.freezeData"  class="app-modal-body" >
    <ng-container *ngIf="this.freezeData.newRevisionDocuments.length>0 || this.freezeData.documentLock;else nodata">
      <div class="row">
        <div class="col-sm-12" style="text-align: right;">
          <a *ngIf="this.freezeData.draftList.length>0" href="javascript:" (click)="loadRecordView(this.freezeData.draftList);">
            View draft
          </a> &nbsp;&nbsp;&nbsp;
          <a *ngIf="this.freezeData.newRevisionDocuments.length>0" href="javascript:" (click)="loadRecordView(this.freezeData.newRevisionDocuments);">
            View completed
          </a>
        </div>
        <div class="col-sm-12">
          <textarea [(ngModel)]="this.freezeData.documentLockComments" id="documentApprovalComment"
            placeholder="please enter the comments to lock or un-lock " name="description" class="form-control" rows="3"
            cols="40"> </textarea>
        </div>
        <div class="col-sm-8">
          <br>
          <ng-container *ngIf="this.freezeData.documentLock && this.freezeData.documentLockComments">
            <div class="row">
              <label class="form-control-label col-sm-12">Select next revision</label>
              <br>
              <div class="col-sm-12  pl-5">
                <label class="radio-inline" *ngIf="this.freezeData.revisionVersionZero">
                  <input class="form-check-input" type="radio" [(ngModel)]="this.freezeData.selectedVersion" name="opt"
                    [value]="this.freezeData.revisionVersionZero" />{{this.freezeData.revisionVersionZero}}</label> &nbsp; &nbsp;
                <label class="radio-inline">
                  <input class="form-check-input" type="radio" [(ngModel)]="this.freezeData.selectedVersion" name="opt"
                    [value]="this.freezeData.revisionVersionTwo" />{{this.freezeData.revisionVersionTwo}}</label> &nbsp; &nbsp;
                <label class="radio-inline">
                  <input class="form-check-input" type="radio" [(ngModel)]="this.freezeData.selectedVersion" name="opt"
                    checked
                    [value]="this.freezeData.revisionVersionOne" />{{this.freezeData.revisionVersionOne}}</label>
              </div>
            </div>
          </ng-container>
        </div>
        <div class="col-sm-12 text-center">
          <button
            *ngIf="(null!=this.freezeData.selectedVersion || !this.freezeData.documentLock)&& this.freezeData.documentLockComments"
            (click)="saveDocumentLockAndUnlock()" class="btn btn-primary btn-sm pointer" type="button"><i
              class="icofont icofont-save"></i>
            {{this.freezeData.documentLock?'Unlock Document':'Lock Document'}} </button>
        </div>
      </div>
    </ng-container>

    <ng-template #nodata>
      <div class="text-center col-sm-12">
        <h5>No new item created</h5>
      </div>
      
    </ng-template>
    <hr>
    <div *ngIf="this.documentlockDataLogs.length>0"  [ngClass]="(this.freezeData.newRevisionDocuments.length>0 || this.freezeData.documentLock)? 'dy-width-300':'dy-width-400'" >
      <h5>Document Lock Log</h5><br>
      <div *ngFor="let item of this.documentlockDataLogs">
        <div><b>Status : {{item.status?'Locked':'Un-Locked'}} </b>&nbsp;</div>
        <div><b>Revision : {{item.revision}} </b>&nbsp;</div>
        <div><b> <i class="{{item.status?' fa fa fa-lock ':'fa fa-unlock'}}"></i> By :</b>&nbsp;{{item.userName}} </div>
        <div><b><i class="{{item.status?' fa fa fa-lock ':'fa fa-unlock'}}"></i> Time :</b>&nbsp; {{item.createdTime}}
        </div>
        <div><b>Comments :</b> {{item.comments}} </div>
        <hr>
      </div>
    </div>
    <div *ngIf="this.spinnerFlag" class="loading">Loading&#8230;</div>
  </div>
</app-modal-basic>

<app-modal-basic class="reset-this" #revisionDocs container="body" [hideHeader]="true" [hideFooter]="true"
  [dialogClass]="'modal-md'">
  <div *ngIf="null!=this.freezeData" class="app-modal-body" style="height: 300px; overflow-y: scroll;">
    <button type="button" class="close basic-close-light-box" (click)="revisionDocs.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    <div *ngIf="null!=this.freezeData && this.viewList.length>0" class="overflow-container"
      slimScroll railVisible="true" railColor="#004a6d" width="100%" height="auto" size="8px" color="#999" opacity="0.6"
      allowPageScroll="false">
      <h5>View Records</h5><br>
      <table class="table table-framed">
        <tr>
          <th>#</th>
          <th>Document Code </th>
          <th>Title/Desc(if any) </th>
        </tr>
        <tr *ngFor="let n of this.viewList;let c=index">
          <td>{{c+1}} </td>
          <td>{{n.documentCode}}</td>
          <td>{{n.name}} </td>
        </tr>
      </table>
    </div>
  </div>
</app-modal-basic>
<app-project-checklist #projectCheckList (onClose)="onClosecheckListModal()"></app-project-checklist>

<app-modal-basic #projectStatusModal [hideHeader]="false" [hideFooter]="false" [dialogClass]="'modal-md'">
  <div class="app-modal-header">
    <h5 class="font-header"><strong>project Status</strong></h5>
    <button type="button" class="close basic-close" (click)="onCloseProjectStatusModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="row">
      <div class="col-sm-12">
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">Validation status <span class="asterisk required">*</span></label>
          <div class="col-sm-10">
            <span>
              <select class="form-control" [(ngModel)]="projectStatusDTO.validationStatus">
                <option *ngFor="let data of this.validationStatusList;" [value]="data.key">{{data.value}}
                </option>
              </select>
            </span>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">System status<span class="asterisk required">*</span></label>
          <div class="col-sm-10">
            <span>
              <select class="form-control" [(ngModel)]="projectStatusDTO.systemStatus">
                <option *ngFor="let data of this.systemStatusList;" [value]="data.key">{{data.value}}
                </option>
              </select>
            </span>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">Comments<span class="asterisk required">*</span></label>
          <div class="col-sm-10">
            <span>
              <textarea style="width:-webkit-fill-available" [(ngModel)]="projectStatusDTO.comments"
                 name="remarks" #remarks="ngModel" [attr.rows]="3"></textarea>
            </span>
          </div>
        </div>
      </div>
      <div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>
    </div>
  </div>
  <div style="width: 100%;" class="app-modal-footer">
    <div class="row">
      <div style="text-align: center;" class="col-sm-12">
        <button class="btn btn-success" [disabled]="projectStatusDTO.comments == ''" (click)="saveStatus();">Update</button>
        <button class="btn btn-danger" (click)="onCloseProjectStatusModal()">Cancel</button>
      </div>
    </div>
  </div>
</app-modal-basic>