<div class="row" *ngIf="!this.viewIndividualData">
  <div class="col-sm-12">
    <app-card>
      <div class="row">
        <div class="col-sm-6">
          <h4 class="f-w-600 strong">Risk Assessment</h4>
        </div>
        <div class="col-sm-6">

          <a *ngIf="modal.publishButtonFlag && isSelectedPublishData && !isWorkflowDocumentOrderSequence"
            href="javascript:" class="m-l-20"><img class="image-radius rounded-0 img-25"
              src="assets/icon/png-icons/published.png" alt="Publish" placement="bottom" ngbTooltip="Publish"
              (click)="publishData()"></a>

          <div style="float: right;">
            <span *ngIf="this.isMultiplePDF"><i (click)="multipleDocumentPreview(false,'pdf');" placement="top"
                container="body" ngbTooltip="Download Pdf File" style="font-size: 34px;color: #e82c2c;"
                class="icofont icofont-file-pdf" title="Download Pdf File"></i>&nbsp;</span>

            <span *ngIf="this.isMultiplePDF"><i (click)="multipleDocumentPreview(false,'docx');" placement="top"
                container="body" ngbTooltip="Download Doc File" style="font-size: 34px;color: #3232e6;"
                class="icofont icofont-file-word" title="Download Doc File"></i>&nbsp;</span>

            <a *ngIf="this.search" href="javascript:" class="m-r-15"><img class="image-radius rounded-0 img-25"
                src="assets/icon/png-icons/search.png" alt="Search" placement="bottom" ngbTooltip="Search"
                (click)="this.showSearch=!this.showSearch"></a>
            <input *ngIf="this.search && this.showSearch" type="search" [(ngModel)]="filterQuery"
              (ngModelChange)="this.helper.setPaginator(table)" class="form-control input-sm full-data-search m-r-15"
              placeholder="Search">

            <a *ngIf="modal.userInWorkFlow" href="javascript:" class="m-r-15"><img class="image-radius rounded-0 img-27"
                src="assets/icon/png-icons/addDoc.png" alt="Add Risk Assessment" placement="bottom"
                ngbTooltip="Add Risk Assessment" (click)="createRisk()"></a>

            <a *ngIf="modal.userInWorkFlow && viewCsvExport && modal.exportButtonFlag" href="javascript:"
              class="m-r-15"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/csvExport.png"
                alt="CSV Export" placement="bottom" ngbTooltip="CSV Export" (click)="excelExport()"></a>

            <a *ngIf="modal.userInWorkFlow && modal.exportButtonFlag && viewPdfPreview && this.search && this.draftIds && this.draftIds.length>0"
              href="javascript:" class="m-r-15"><img class="image-radius rounded-0 img-25"
                src="assets/icon/png-icons/pdfExport.png" alt="PDF Export" placement="bottom" ngbTooltip="PDF Export"
                (click)="this.viewpdf=true; draftPdfPreview.show()"></a>

            <a *ngIf="modal.userInWorkFlow" href="javascript:" class="m-r-15"><img class="image-radius rounded-0 img-25"
                src="assets/icon/png-icons/menu.png" alt="Table of Content" placement="bottom"
                ngbTooltip="Table of Content" (click)="onClickTableOfContent()"></a>

            <a *ngIf="this.search && modal.userInWorkFlow" href="javascript:"><img class="image-radius rounded-0 img-30"
                src="assets/icon/png-icons/forum.png" alt="Forum" placement="bottom" ngbTooltip="Forum"
                (click)="openDocumentForum()"></a>
          </div>
          <br>
        </div>
      </div>
      <div class="messages text-danger" *ngIf="modal.publishButtonFlag && isSelectedPublishData">
        {{isWorkflowDocumentOrderSequence}}</div>
      <div class="messages text-danger" *ngIf="!this.modal.userInWorkFlow && !spinnerFlag">Note* : You are not in
        workflow. Please contact admin!. </div>
      <div class="messages text-danger m-b-10" *ngIf="tab && tab.activeId=='draft' && documentLock">Note* : Document is
        locked, Navigate to summary page to unlock a document.</div>
      <br>

      <ngb-tabset #riskTab="ngbTabset" (tabChange)="tabChange($event.nextId);">
        <ngb-tab id="summary" title="Summary">
          <ng-template ngbTabContent>
            <app-individual-document-summary [permissionConstant]="this.helper.RISK_ASSESSMENT_VALUE"
              (onCloseSummary)="loadPermissions();"></app-individual-document-summary>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Draft" id="draft">
          <ng-template ngbTabContent>
            <ngx-datatable [scrollbarH]="true" #myTable class="data-table dt-chk"
              [rows]='unPublishedList | RiskFilterPipe : filterQuery' [columnMode]="'force'" [headerHeight]="50"
              [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="page.totalElements"
              [offset]="page.pageNumber" [limit]="page.size" (page)="setPage($event)">
              <ngx-datatable-column *ngIf="modal.publishButtonFlag" name="Select" [width]="70" [sortable]="false"
                [canAutoResize]="false" [draggable]="false" [resizeable]="false">
                <ng-template class="datatable-checkbox" ngx-datatable-header-template let-row="row">
                  <div class="checkbox-fade fade-in-primary datatable-header-cell-label">
                    <label *ngIf="filterQuery=='' && unPublishedList.length !=0 " container="body" placement="right"
                      triggers="mouseenter:mouseleave" ngbPopover="Select All">
                      <input type="checkbox" [checked]="selectAll"
                        (click)="selectAllData($event);loadSelectAllDataForPublish($event)" />
                      <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                    </label>
                  </div>
                </ng-template>

                <ng-template class="datatable-checkbox" ngx-datatable-cell-template let-row="row"
                  let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
                  <div class="checkbox-fade fade-in-primary" *ngIf="row.allURSWFCompleted && row.allSpecWFCompleted">
                    <label>
                      <input type="checkbox" name="{{row['assessmentCode']}}" [checked]="row.publishedflag"
                        (change)="row.publishedflag=!row.publishedflag;onChangePublishData();" />
                      <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                    </label>
                  </div>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Action" [width]="170">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <ng-template #popContent>
                    <span class="text-left">
                      <div><b>Status :</b>&nbsp; {{row['status']}}</div>
                      <div><b>Created By :</b> {{row['createdBy']}}</div>
                      <div><b>Created On :</b>{{row['displayCreatedTime']}}</div>
                      <div><b>Last Modified By : </b> {{row['updatedBy']}}</div>
                      <div><b>Last Modified On : </b>{{row['displayUpdatedTime'] }}</div>
                    </span>
                  </ng-template>
                  <a container="body" href="javascript:;" class="m-r-15 crm-action-info text-muted text-primary"
                    placement="right" (click)="loadDocumentCommentLog(row)" placement="top" ngbTooltip="Info">
                    <i class="icofont icofont-info-square info"></i>
                  </a>
                  <a container="body" *ngIf="modal.updateButtonFlag" href="javascript:;" routerLinkActive="active"
                    [routerLink]="['/add-riskAssessment',row.id]" class="m-r-15 crm-action-edit text-muted text-primary"
                    placement="top" ngbTooltip="Edit">
                    <i class="icofont icofont-edit edit"></i>
                  </a>
                  <a container="body" *ngIf="modal.deleteButtonFlag" href="javascript:;"
                    class="m-r-15 crm-action-delete text-muted text-danger"
                    (click)="openSuccessCancelSwal(row , row['$$index'] );" placement="top" ngbTooltip="Delete">
                    <i class="icofont icofont-bin bin"></i>
                  </a>
                  <a container="body" *ngIf="modal.viewButtonFlag" href="javascript:;"
                    class="m-r-15 crm-action-view text-muted text-warning"
                    (click)="viewRowDetails(row.id,row.commonDocumentStatusValue);" data-ng-open="modalSmall"
                    placement="top" ngbTooltip="View">
                    <i class="icofont icofont-resize view"></i>
                  </a>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="ID" [width]="100">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong>{{row['assessmentCode']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Risk Factor" [width]="400">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong>{{row['riskFactor']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Priority">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;"
                    [ngStyle]="{'background-color': row['priorityColor'] }" class="badge"
                    style="width: 100px;font-size:15px;color: black;">{{row['priorityName']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="RPN Number">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['rpn']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Prob of Occurance">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['probabilityOfOccurance']}}({{row['probabilityOfOccuranceName']}})</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Severity">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['severity']}}({{row['severityName']}})</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Detectability">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['detectability']}}({{row['detectabilityName']}})</strong>
                </ng-template>
              </ngx-datatable-column>



              <ngx-datatable-column name="Criticality">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['critical']}}</strong>
                </ng-template>
              </ngx-datatable-column>



              <ngx-datatable-column name="Document Status">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['status']}}</strong>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Published" id="published">
          <ng-template ngbTabContent>
            <ngx-datatable [scrollbarH]="true" #myTable class="data-table dt-chk"
              [rows]='publishedList | RiskFilterPipe : filterQuery' [columnMode]="'ColumnMode.force'"
              [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true"
              [count]="page.totalElements" [offset]="page.pageNumber" [limit]="page.size" (page)="setPage($event)">

              <ngx-datatable-column name="Action" [width]="180">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <ng-template #popContent>
                    <span class="text-left">
                      <div><b>Status :</b>&nbsp; {{row['status']}}</div>
                      <div><b>Created By :</b> {{row['createdBy']}}</div>
                      <div><b>Created On :</b>{{row['displayCreatedTime']}}</div>
                      <div><b>Last Modified By : </b> {{row['updatedBy']}}</div>
                      <div><b>Last Modified On : </b>{{row['displayUpdatedTime'] }}</div>
                    </span>
                  </ng-template>
                  <a container="body" href="javascript:;" class="m-r-15 crm-action-info text-muted text-primary"
                    placement="right" (click)="loadDocumentCommentLog(row)" placement="top" ngbTooltip="Info">
                    <i class="icofont icofont-info-square info"></i>
                  </a>
                  <a container="body" *ngIf="modal.viewButtonFlag" href="javascript:;"
                    class="m-r-15 crm-action-view text-muted text-warning"
                    (click)="viewRowDetails(row.id,row.commonDocumentStatusValue);" data-ng-open="modalSmall"
                    placement="top" ngbTooltip="View">
                    <i class="icofont icofont-resize view"></i>
                  </a>
                  <a container="body" href="javascript:;" (click)="onClickTestCases(row.id)"
                    *ngIf="testCase.createButtonFlag && testcaseWorkFlowPer && isTestcaseModulePermission"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Add Testcases">
                    <i style="color: #3AA655;" class="icofont icofont-login"></i>
                  </a>
                  <a container="body" href="javascript:;" (click)="onClickUnScriptedTestCases(row.id)"
                    *ngIf="unScriptedTestCase.createButtonFlag && isUnScriptedTestcaseModulePermission"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top"
                    ngbTooltip="Add Unscripted Testcases">
                    <i class="text-warning icofont icofont-login"></i>
                  </a>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="ID" [width]="200">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong>{{row['assessmentCode']}} {{row['revisionNumber']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Risk Factor" [width]="400">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong>{{row['riskFactor']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Priority">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;"
                    [ngStyle]="{'background-color': row['priorityColor'] }" class="badge"
                    style="width: 100px;font-size:15px;color: black;">{{row['priorityName']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="RPN Number">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['rpn']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Prob of Occurance">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['probabilityOfOccurance']}}({{row['probabilityOfOccuranceName']}})</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Severity">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['severity']}}({{row['severityName']}})</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Detectability">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['detectability']}}({{row['detectabilityName']}})</strong>
                </ng-template>
              </ngx-datatable-column>


              <ngx-datatable-column name="Criticality">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['critical']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Document Status">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['status']}}</strong>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </ng-template>
        </ngb-tab>
        <!-- <ngb-tab id="documentForms" title="Document Forms">
					<ng-template ngbTabContent>
						<app-document-forms [permissionConstant]="this.helper.RISK_ASSESSMENT_VALUE"></app-document-forms>
					</ng-template>
				</ngb-tab> -->
        <ngb-tab id="approve" title="Approve / PDF View">
          <ng-template ngbTabContent>
            <app-individual-document-workflow [permissionConstant]="this.helper.RISK_ASSESSMENT_VALUE"
              (onClose)="tabChange('approve');">
            </app-individual-document-workflow>
          </ng-template>
        </ngb-tab>
        <ngb-tab id="feedback" title="Feedback">
          <ng-template ngbTabContent>
            <br>
            <app-document-forum #forumView [constant]="this.helper.RISK_ASSESSMENT_VALUE" [isDocumentWorkFlow]="true"
              [documentList]="this.commentsDocumentsList"></app-document-forum>
          </ng-template>
        </ngb-tab>
        <ngb-tab id="audit" title="Audit Trail">
          <ng-template ngbTabContent>
            <app-audit-trail-view #auditView [permission]="this.helper.RISK_ASSESSMENT_VALUE"></app-audit-trail-view>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </app-card>
  </div>
</div>


<div *ngIf="this.viewIndividualData==true">
  <div *ngFor="let data of riskAssesmentData; let in = index">
    <app-card id="individual-header-card">
      <div class="row">
        <div class="col-sm-3 d-inline">
          <h5 class="strong">&nbsp;&nbsp;Risk Assessment Id : </h5>
          <span style="font-size: 14px;">{{data.assessmentCode}} {{data.revisionNumber}}</span>
        </div>
        <div class="col-sm-3" style="text-align: center;">
          <app-navigation-bar #navigate (resultValue)='reload($event)' id='{{data.id}}' [total]='this.total'
            [current]='this.current' [freeznext]='data.navigationNextEnds' [freezprevious]='data.navigationPreviousEnds'
            docType='113' routeBack='{{this.routeback}}'>
          </app-navigation-bar>
        </div>
        <div class="col-sm-3">
          <app-stepperprogress *ngIf="data.publishedflag" [isIcon]="true"></app-stepperprogress>
        </div>
        <div class="col-sm-3" style="text-align: right;">
          <button *ngIf="(this.modal.updateButtonFlag && !data.publishedflag)" type="button"
            class="btn btn-sm btn-primary  waves-effect waves-light m-r-10"
            [routerLink]="['/add-riskAssessment',data.id]">Edit</button>
          <button
            *ngIf="modal.publishButtonFlag && !data.publishedflag && !isWorkflowDocumentOrderSequence && data.allURSWFCompleted && data.allSpecWFCompleted"
            type="button" class="btn btn-sm btn-warning  waves-effect waves-light m-r-10"
            (click)="SinglepublishData(data)">Publish</button>
          <button *ngIf="(this.modal.deleteButtonFlag && !data.publishedflag)" type="button"
            class="btn btn-sm btn-danger  waves-effect waves-light m-r-10"
            (click)="openSuccessCancelSwal(data,in)">Delete</button>
          <span *ngIf="data.documentPreviewFlag"><i (click)="documentPreview(false,'pdf',data);" placement="top"
              container="body" ngbTooltip="Download Pdf File" style="font-size: 34px;color: #e82c2c;"
              class="icofont icofont-file-pdf" title="Download Pdf File"></i></span>
          <span *ngIf="data.documentPreviewFlag"><i (click)="documentPreview(false,'docx',data);" placement="top"
              container="body" ngbTooltip="Download Doc File" style="font-size: 34px;color: #3232e6;"
              class="icofont icofont-file-word" title="Download Doc File"></i></span>
          <a container="body" href="javascript:;" (click)="onClickTestCases(data.id)"
            *ngIf="testCase.createButtonFlag && testcaseWorkFlowPer && isTestcaseModulePermission && data.status!='Draft'"
            class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Add Testcases">
            <i style="color: #3AA655;" class="icofont icofont-login"></i>
          </a>
          <a container="body" href="javascript:;" (click)="onClickUnScriptedTestCases(data.id)"
            *ngIf="unScriptedTestCase.createButtonFlag && isUnScriptedTestcaseModulePermission && data.publishedflag"
            class="m-r-15 crm-action-edit text-muted text-primary" placement="top"
            ngbTooltip="Add Unscripted Testcases">
            <i class="text-warning icofont icofont-login"></i>
          </a>
          <button *ngIf="routeback!=null && roleBack==null" type="button"
            class="btn btn-sm btn-danger waves-effect waves-light m-r-10"
            [routerLink]="[this.commonDocumentStatusValue]">Cancel</button>
          <button *ngIf="routeback!=null && roleBack!=null" type="button"
            class="btn btn-sm btn-danger waves-effect waves-light m-r-10"
            [routerLink]="[this.commonDocumentStatusValue]" [queryParams]="{ id: this.roleBack}">Cancel</button>
          <button *ngIf="routeback==null" type="button" class="btn btn-sm btn-danger waves-effect waves-light m-r-10"
            (click)="onClickClose()">Cancel</button>
        </div>
      </div>
    </app-card>


    <div class="row p-l-2">
      <div class="col-sm-12">
        <label><strong class="strong">URS : </strong>
          <ng-container *ngFor="let urs of data.ursDetails; let i = index;">
            <a (click)="urlRedirection(urs.id, data.id)"><u class="black pointer text-primary">{{urs.ursCode}}<label
                  *ngIf="data.ursDetails.length!=(i+1)">,</label></u></a>
          </ng-container>
          <span class="pointer" (click)="this.ursDetailedView = !this.ursDetailedView">&nbsp;<i
              [ngClass]="this.ursDetailedView?'fa-minus-square text-danger':'fa-plus-square text-success'" class="fa"
              aria-hidden="true"></i></span>
        </label>
      </div>
      <div class="col-sm-12" *ngIf="this.ursDetailedView">
        <app-urs-spec-risk-view [dataList]="this.selectedUrsDetails" constant="113" backUrl="/riskAssessment">
        </app-urs-spec-risk-view>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <table id="add-table" class="table w-100">
          <tbody>
            <tr *ngIf="data.failTestCaseId!=0">
              <td colspan="2">
                <div><strong class="strong">Test Case : </strong>{{data.failTestCaseCode}}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div><strong class="strong">Document Status : </strong><span class="text-warning">{{data.status}}</span>
                </div>
              </td>
              <td>
                <div><strong class="strong">Severity : </strong>{{data.severityName}}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div><strong class="strong">Risk Factor : </strong>{{data.riskFactor}}</div>
              </td>
              <td>
                <div><strong class="strong">Detectability : </strong>{{data.detectabilityName}}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div><strong class="strong">Risk Scenario : </strong>{{data.riskScenario}}</div>
              </td>
              <td>
                <div><strong class="strong">RPN : </strong>{{data.rpn}}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div><strong class="strong">Probable Cause of Risk : </strong>{{data.probableCauseOfRisk}}</div>
              </td>
              <td>
                <div><strong class="strong">Criticality : </strong>{{data.critical}}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div><strong class="strong">Probability Of Occurance : </strong>{{data.probabilityOfOccuranceName}}
                </div>
              </td>
              <td>
                <div><strong class="strong">Priority : </strong><span
                    [ngStyle]="{'color': this.returnColor}">{{data.priorityName}}</span></div>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <div><strong class="strong">Proposed Mitigation : </strong>{{data.proposedMitigation}}</div>
              </td>
            </tr>
            <tr *ngIf="data.status === 'Completed' && !data.residualSavedFlag">
              <td colspan="2">
                <div>
                  <strong class="strong"> Residual Risk Assessment: </strong>
                  <label class="switch">
                    <input type="checkbox" name="residualRiskAssessment" [(ngModel)]="residualRiskAssessment"
                      (change)="onClickResidual(data);" />
                    <span class="slider round"></span>
                  </label>
                </div>
              </td>
            </tr>
            <tr *ngIf="data.residualSavedFlag">
              <td colspan="2">
                <div style="text-align: center;">
                  <strong class="strong"> Residual Risk Assessment Details</strong>
                </div>
              </td>
            </tr>
            <tr *ngIf="data.residualSavedFlag">
              <td>
                <div><strong class="strong">Probability Of Occurance : </strong>{{data.residualProbabilityName}}</div>
              </td>
              <td>
                <div><strong class="strong">RPN : </strong>{{data.residualRpn}}</div>
              </td>
            </tr>
            <tr *ngIf="data.residualSavedFlag">
              <td>
                <div><strong class="strong">Severity : </strong>{{data.residualServerityName}}</div>
              </td>
              <td>
                <div><strong class="strong">Criticality : </strong>{{data.residualCritical}}</div>
              </td>
            </tr>
            <tr *ngIf="data.residualSavedFlag">
              <td>
                <div><strong class="strong">Detectability : </strong>{{data.residualDetetablityName}}</div>
              </td>
              <td>
                <div><strong class="strong">Priority : </strong><span
                    [ngStyle]="{'color': this.residualReturnColor}">{{data.residualPriorityName}}</span></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <app-view-form [inputField]='this.riskAssesmentData'></app-view-form>

    <div class="row" *ngIf="this.testcaseData.length > 0">
      <div class="col-sm-12">
        <app-card>
          <div class="row">
            <div class="col-sm-6 strong"><strong>&nbsp;&nbsp;Risk Mapped To </strong>
            </div>
            <div class="col-sm-6" style="text-align: right;">
              <a container="body" *ngIf="!this.viewFlagUrs" href="javascript:;"
                (click)="this.viewFlagUrs = !this.viewFlagUrs" class="m-r-15 crm-action-edit text-muted text-primary"
                placement="top" ngbTooltip="Expand"><i style="font-size: 25px;color: black;"
                  class="icofont icofont-circled-down"></i>
              </a>
              <a container="body" *ngIf="this.viewFlagUrs" href="javascript:;"
                (click)="this.viewFlagUrs = !this.viewFlagUrs" class="m-r-15 crm-action-edit text-muted text-primary"
                placement="top" ngbTooltip="Hide"><i style="font-size: 25px;color: black;"
                  class="icofont icofont-circled-up"></i>
              </a>
            </div>
          </div>
          <br>
          <div *ngIf="this.viewFlagUrs">
            <div *ngFor="let d of this.testcaseData">
              <div *ngIf="d.key === '150'">
                <div>&nbsp;&nbsp;<Strong>{{d.name}}</Strong></div>
                <div class="row">
                  <div class="col-sm-12">
                    <ngx-datatable [scrollbarH]="true" #myTable id="childCustomTable" class="data-table dt-chk"
                      style="overflow: unset!important;" [rows]='d.value' [limit]="5" [columnMode]="'force'"
                      [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">

                      <ngx-datatable-column style="font-weight: bold;" name="Test Id">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <a href="javascript:;" (click)="navigateToChild(d.key,row)" class="btn btn-link p-0">
                            <strong>{{row['testCaseCode']}}</strong>
                          </a>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column style="font-weight: bold;" name="Test RunName">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong style="font-weight: normal;">{{row['testRunName']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column style="font-weight: bold;" name="Test Description">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['description']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Document Status">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['approvedStatus']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Expected Result">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['expectedResult']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Actual Result">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['actualResult']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Status">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['status']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>
                    </ngx-datatable>
                  </div>
                </div>
              </div>
              <div *ngIf="d.key === '201'">
                <div>&nbsp;&nbsp;<Strong><br>{{d.name}}</Strong></div>
                <div class="row">
                  <div class="col-sm-12">
                    <ngx-datatable [scrollbarH]="true" #myTable id="childCustomTable" class="data-table dt-chk"
                      style="overflow: unset!important;" [rows]='d.value' [limit]="5" [columnMode]="'force'"
                      [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">

                      <ngx-datatable-column style="font-weight: bold;" name="Ad-hoc Id">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <a href="javascript:;" (click)="navigateToChild(d.key,row)" class="btn btn-link p-0">
                            <strong>{{row['testCaseCode']}}</strong>
                          </a>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Test Description">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['description']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Test Result">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['expectedResult']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Status">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['status']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Business Impact">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                          <strong
                            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['businessImpact']}}</strong>
                        </ng-template>
                      </ngx-datatable-column>
                    </ngx-datatable>
                  </div>
                </div>
              </div>
              <br>
            </div>
          </div>
        </app-card>
      </div>
    </div>

    <app-individual-audit-trail [permission]="this.helper.RISK_ASSESSMENT_VALUE" [id]="data.id">
    </app-individual-audit-trail>

    <hr>
    <app-document-forum></app-document-forum>

  </div>
</div>

<app-modal-basic #draftPdfPreview [hideHeader]="false" [hideFooter]="false" [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <button type="button" class="close basic-close-light-box" (click)="draftPdfPreview.hide(); this.viewpdf=false;">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <app-draft-pdf *ngIf="viewpdf" [permissionConstant]="this.helper.RISK_ASSESSMENT_VALUE" [draftIds]="this.draftIds">
    </app-draft-pdf>
  </div>
</app-modal-basic>

<div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>

<app-document-status-comment-log #documentcomments></app-document-status-comment-log>

<app-individual-document-forum #forumView [constant]="this.helper.RISK_ASSESSMENT_VALUE"
  [documentList]="this.commentsDocumentsList"></app-individual-document-forum>