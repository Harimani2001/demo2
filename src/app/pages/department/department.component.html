<div class="row">
  <div class="col-sm-12">
    <app-card>
      <form #deptForm="ngForm">
        <table id="add-table" class="table w-100">
          <tbody>
            <tr>
              <td colspan="3">
                <div class="row">
                  <div class="col-sm-2">
                    <strong class="strong">Orgnization Name<span class="asterisk required">*</span> :</strong>
                  </div>
                  <div class="col-sm-10">
                    <input type="text" disabled class="form-control" name="orgName" placeholder="Orgnization Name"
                      [(ngModel)]="modal.organizationName" required />
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div class="row">
                  <div class="col-sm-3">
                    <strong class="strong">Location<span class="asterisk required">*</span> :</strong>
                  </div>
                  <div class="col-sm-9">
                    <select name="location" id="location" class="form-control" [(ngModel)]="modal.location" required
                      #locationName="ngModel" (ngModelChange)="showNext();" [disabled]="modal.id!=0">
                      <option value="">Select Location</option>
                      <option *ngFor="let location of locationsList" [value]="location.id">{{location.name}}</option>
                    </select>
                    <div class="messages text-danger"
                      *ngIf="(locationName.touched|| submitted) && (locationName.hasError('required') || modal.location==0 )">
                      {{errorTypes.locationValidation}}</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="row">
                  <div class="col-sm-3 col-dep-3">
                    <strong class="strong">Department Code<span class="asterisk required">*</span> :</strong>
                  </div>
                  <div class="col-sm-9 col-dep-9">
                    <input type="text" id="deptCode" class="form-control" name="departmentCode"
                      [(ngModel)]="modal.departmentCode" #departmentCode="ngModel" maxlength="50"
                      placeholder="Department Code" required/>
                    <div class="messages text-danger"
                      *ngIf="(departmentCode.touched || submitted) && departmentCode.errors?.required">
                      {{errorTypes.departmentCodeValidation}}</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="row">
                  <div class="col-sm-3 col-dep-3">
                    <strong class="strong">Department Name<span class="asterisk required">*</span> :</strong>
                  </div>
                  <div class="col-sm-9 col-dep-9">
                    <input type="text" id="deptName" class="form-control" name="departmentName"
                      [(ngModel)]="modal.departmentName" #departmentName="ngModel" pattern="[A-Za-z]{49}"
                      (ngModelChange)="showNext();" [pattern]="helper.AlphaNumericUnderscoreAndSpace_pattern" required
                      placeholder="Department Name" maxlength="50" />
                    <div class="messages text-danger" *ngIf="this.validationMessage !=''">{{this.validationMessage}}
                    </div>
                    <div class="messages text-danger" *ngIf="departmentName?.errors?.pattern">
                      {{errorTypes.departmentNamePatternValidation}}</div>
                    <div class="messages text-danger"
                      *ngIf="(departmentName.touched || submitted) && departmentName.errors?.required">
                      {{errorTypes.departmentNameValidation}}</div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="form-group row">
          <div class="col-sm-12 text-center">
            <button type="button" *ngIf="this.showButtonFlag && !this.updateFlag && permisionModal.createButtonFlag"
              [disabled]="disableButtonFlag" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
              (click)="onsubmit(deptForm.valid);">Save</button>
            <button type="button" *ngIf="this.showButtonFlag && this.updateFlag && permisionModal.updateButtonFlag"
              [disabled]="disableButtonFlag" class="btn btn-sm btn-success waves-effect waves-light m-r-10"
              (click)="onsubmit(deptForm.valid);">Update</button>
            <button type="button" class="btn btn-sm btn-danger waves-effect waves-light"
              (click)="onClickCancel();">Cancel</button>
          </div>
        </div>
      </form>
    </app-card>

    <div class="row">
      <div class="col-sm-12">
        <app-card>
          <div class="row">
            <div class="col-xs-12 col-sm-12 col-sm-12 col-md-6"></div>
            <div class="col-xs-12 col-sm-12 col-md-6">
              <div style="text-align: right;">
                <label>Search:
                  <input type="search" [(ngModel)]="filterQuery" (ngModelChange)="this.helper.setPaginator(table);"
                    class="form-control input-sm full-data-search" placeholder="Search name">
                </label>
              </div>
            </div>
          </div>
          <ngx-datatable [scrollbarH]="true" #myTable class="data-table dt-chk"
            [rows]='departmentList | DepartmentFilterPipe : filterQuery' [limit]="10" [columnMode]="'force'"
            [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">
            <ngx-datatable-column name="Sl No." [width]="50">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <strong>{{row['$$index']+1}}</strong>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column style="font-weight: bold;" name="Department Code">
              <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['departmentCode']}}</strong>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column style="font-weight: bold;" name="Department">
              <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['departmentName']}}</strong>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column style="font-weight: bold;" name="Location">
              <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                <strong
                  style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['locationName']}}</strong>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Action">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <a *ngIf="permisionModal.updateButtonFlag" container="body" href="javascript:;"
                  (click)="editDepartment(row);" class="crm-action-edit text-muted text-primary" placement="top"
                  ngbTooltip="Edit"><i class="icofont icofont-edit edit"></i>
                </a>
                <a *ngIf="permisionModal.deleteButtonFlag" container="body" href="javascript:;"
                  class="m-r-15 crm-action-delete text-muted text-danger" (click)="openSuccessDeleteSwal(row);"
                  placement="top" ngbTooltip="Delete"><i class="icofont icofont-bin bin"></i>
                </a>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </app-card>
      </div>
    </div>
  </div>
</div>

<app-modal-basic #alertMessage>
  <div class="app-modal-header">
    <h4 class="modal-title">Please check!</h4>
  </div>
  <div class="app-modal-body">
    <label>This Department is used in the below modules:</label>
    <br>
    <div *ngFor="let row of this.moduleNames;let i = index">
      {{i+1 }} . <label class="label label-primary">{{row}}</label>
    </div>
    <br>
    <label>Kindly release Department in above mentioned modules and proceed further.</label>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect" (click)="alertMessage.hide();">OK</button>
  </div>
</app-modal-basic>

<div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>