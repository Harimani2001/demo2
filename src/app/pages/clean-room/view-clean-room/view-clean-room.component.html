<div class="row" *ngIf="!this.individualView">
  <div class="col-sm-12">
    <app-card>
      <div class="col-sm-12" id="float-action">
        <app-card>
          <div class="row">
            <div class="col-sm-2 page-header-title">
              <i class="icofont icofont-file-document bg-c-blue"></i>
              <div class="d-inline">
                <h4 class="strong">Cleanroom</h4>
                <span>View Cleanroom</span>
              </div>
            </div>
            <div class="col-sm-2">
              <div
                *ngIf="this.tab && (this.tab.activeId == 'draft' || this.tab.activeId == 'publish' || this.tab.activeId == 'audit')">
                <angular2-multiselect name="locationName" [data]="this.locationList" id="locationId"
                  (ngModelChange)="onChangeLocation($event)" [(ngModel)]="this.location"
                  [settings]="locationDropdownSettings">
                </angular2-multiselect>
              </div>
            </div>
            <div class="col-sm-3">
              <div
                *ngIf="this.tab && (this.tab.activeId == 'draft' || this.tab.activeId == 'publish' || this.tab.activeId == 'audit')">
                <angular2-multiselect name="projectName" [data]="this.projectList" id="projectId"
                  (ngModelChange)="onChangeProject(this.location, $event)" [(ngModel)]="this.project"
                  [settings]="projectDropdownSettings">
                </angular2-multiselect>
              </div>
            </div>
            <div class="col-sm-5 text-right m-t-10">
              <a *ngIf="permissionModal.publishButtonFlag && canPublish" href="javascript:" (click)="multiRoomPublish()"
                class="m-r-15"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/published.png"
                  alt="Publish" placement="bottom" ngbTooltip="Publish"></a>

              <a *ngIf="this.tab && (this.tab.activeId == 'draft' || this.tab.activeId == 'publish')" href="javascript:"
                class="m-r-15"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/search.png"
                  alt="Search" placement="bottom" ngbTooltip="Search" (click)="onClickSearch();"></a>
              <input *ngIf="this.tab && (this.tab.activeId == 'draft' || this.tab.activeId == 'publish') && this.showSearch"
                type="search" id="search_box" [(ngModel)]="filterQuery"
                (ngModelChange)="this.helper.setPaginator(table)" class="form-control input-sm full-data-search m-r-15"
                placeholder="Search">

              <a *ngIf="permissionModal.createButtonFlag" href="javascript:"
                [routerLink]="['/Clean-room/add-cleanroom']" routerLinkActive="active">
                <img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/addDoc.png" alt="Add Room"
                  placement="bottom" ngbTooltip="Add Room"></a>
            </div>
          </div>
        </app-card>
      </div>
      <br><br><br>

      <ngb-tabset #cleanRoomTab="ngbTabset"
        (tabChange)="onTabChange($event.nextId); this.helper.toggleView('cleanRoomTab', $event.nextId)">
        <ngb-tab title="Summary" id="summary">
          <ng-template ngbTabContent>
            <br>
            <app-card *ngIf="summaryData">
              <div class="row">
                <div class="col-sm-12">
                  <div style="display: flex;">
                    <div class="page-header-title">
                      <div class="d-inline">
                        <h4 class="strong">Status</h4>
                      </div>
                    </div>
                    <div class="status">
                      <div style="font-size: 60%;">{{this.percentage}}%</div>
                      <div class="progress" style="height: 0.5em !important;">
                        <div class={{this.progressBarColour}} role="progressbar" aria-valuenow=this.percentage
                          aria-valuemin="0" aria-valuemax="100" [style.width]="this.percentage + '%'"> </div>
                      </div>
                    </div>
                  </div>
                  <div class="room-summary-table">
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr class="header-bg">
                            <th>Draft</th>
                            <th>Published</th>
                            <th>In Progress</th>
                            <th>Completed</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>{{summaryData.draft}}</td>
                            <td>{{summaryData.published}}</td>
                            <td>{{summaryData.inProgress}}</td>
                            <td>{{summaryData.completed}}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </app-card>

            <app-card>
              <div class="row">
                <div class="col-sm-6">
                  <div class="page-header-title">
                    <div class="d-inline">
                      <h4 class="strong">Tasks</h4>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6" style="text-align: right;">
                  <a container="body" *ngIf="!this.taskviewFlag" href="javascript:;"
                    (click)="this.taskviewFlag = !this.taskviewFlag"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Expand">
                    <i style="font-size: 25px;color: black;" class="icofont icofont-circled-down"></i>
                  </a>
                  <a container="body" *ngIf="this.taskviewFlag" href="javascript:;"
                    (click)="this.taskviewFlag = !this.taskviewFlag"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Hide">
                    <i style="font-size: 25px;color: black;" class="icofont icofont-circled-up"></i>
                  </a>
                </div>
              </div>
              <div *ngIf="this.taskviewFlag">
                <div class="row">
                  <div class="col-sm-12">
                    <br>
                    <div *ngIf="pendingList.length == 0">
                      <strong>&nbsp;&nbsp;No Data</strong>
                    </div>
                    <div class="table-responsive" *ngIf="pendingList.length>0">
                      <table class="table">
                        <tr class="header-bg">
                          <th>Task Id</th>
                          <th>Priority</th>
                          <th>Description</th>
                          <th>Due Date</th>
                          <th>Status</th>
                          <th>Time Duration</th>
                          <th>Timer</th>
                          <th>Assigned To</th>
                          <th>Action</th>
                        </tr>
                        <tr *ngFor="let row of pendingList; let i = index;">
                          <td><a class="link" (click)="taskRedirect(row.id)">{{row.taskCode}}</a></td>
                          <td>{{row.priority}}</td>
                          <td>{{row.taskTitle}}</td>
                          <td>{{row.dueDate | date:this.datePipeFormat}}</td>
                          <td>{{row.status}}</td>
                          <td>{{row.timeDuration}}</td>
                          <td>
                            <a *ngIf="row.status != 'Closed' && row.startTimerFlag == 'Y'" container="body"
                              href="javascript:;" class="crm-action-view text-muted text-warning"
                              (click)="startTime(row);" data-ng-open="modalSmall" placement="top" ngbTooltip="Start">
                              <i class="icofont icofont-wall-clock view"></i></a>
                            &nbsp;
                            <a *ngIf="row.status != 'Closed' && row.endTimerFlag == 'Y'" container="body"
                              href="javascript:;" class="crm-action-view text-muted text-warning"
                              (click)="endTime(row);" data-ng-open="modalSmall" placement="top" ngbTooltip="Stop">
                              <i class="icofont icofont-wall-clock bin"></i></a>
                          </td>
                          <td>
                            <ng-container *ngIf="row.isManualEntry=='T';else else_content">
                              <label>{{row.selectedUserNames}}</label>
                            </ng-container>
                            <ng-template #else_content>
                              <label *ngIf="row.taskPermissionFlag"
                                (click)="getLevelUsers(row); selectUserModal.show();"
                                class="text-c-blue">{{row.selectedUserNames}}</label>
                              <label *ngIf="!row.taskPermissionFlag">{{row.selectedUserNames}}</label>
                            </ng-template>
                          </td>
                          <td>
                            <a *ngIf="row.taskPermissionFlag" href="javascript:;" (click)="editTask(row)"
                              class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Edit">
                              <i class="icofont icofont-edit edit"></i>
                            </a>
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </app-card>

            <app-card *ngIf="summaryData && summaryData.validationStatusCount">
              <div class="row">
                <div class="col-sm-6">
                  <div class="page-header-title">
                    <div class="d-inline">
                      <h4 class="strong">Cleanroom statistics</h4>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6" style="text-align: right;">
                  <a container="body" *ngIf="!this.graphViewFlag" href="javascript:;"
                    (click)="this.graphViewFlag = !this.graphViewFlag"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Expand">
                    <i style="font-size: 25px;color: black;" class="icofont icofont-circled-down"></i>
                  </a>
                  <a container="body" *ngIf="this.graphViewFlag" href="javascript:;"
                    (click)="this.graphViewFlag = !this.graphViewFlag"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Hide">
                    <i style="font-size: 25px;color: black;" class="icofont icofont-circled-up"></i>
                  </a>
                </div>
              </div>
              <br>
              <div *ngIf="this.graphViewFlag" class="row">
                <div class="col-sm-1"></div>
                <div class="col-sm-5">
                  <div class="strong m-l-10">Validation Status</div>
                  <br>
                  <div *ngIf="validationChartData.length > 0">
                    <canvas baseChart [data]="validationChartData" [labels]="this.validationChartLabels"
                      [options]="this.pieChartOptions" [chartType]="this.pieChartType" [colors]="this.pieChartColors"
                      (chartHover)="chartHovered($event)" (chartClick)="chartClicked($event)">
                    </canvas>
                  </div>
                </div>
                <div class="col-sm-1"></div>
                <div class="col-sm-5">
                  <div class="strong m-l-10">Classification</div>
                  <br>
                  <div *ngIf="classificationChartData.length > 0">
                    <canvas baseChart [data]="classificationChartData" [labels]="this.classificationChartLabels"
                      [options]="this.pieChartOptions" [chartType]="this.pieChartType" [colors]="this.pieChartColors"
                      (chartHover)="chartHovered($event)" (chartClick)="chartClicked($event)">
                    </canvas>
                  </div>
                </div>
              </div>
            </app-card>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Draft" id="draft">
          <ng-template ngbTabContent>
            <ngx-datatable #myTable [scrollbarH]="false" class="data-table dt-chk" style="overflow: unset!important;"
              [rows]='tableData | CleanRoomFilter : filterQuery' [columnMode]="'force'" [headerHeight]="50"
              [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="page.totalElements"
              [offset]="page.pageNumber" [limit]="page.size" (page)="setPage($event)">

              <ngx-datatable-column *ngIf="permissionModal.publishButtonFlag" name="Select" [width]="50"
                [sortable]="false" [canAutoResize]="false" [draggable]="false" [resizeable]="false">

                <ng-template class="datatable-checkbox" ngx-datatable-header-template let-row="row">
                  <div class="checkbox-fade fade-in-primary datatable-header-cell-label">
                    <label *ngIf="filterQuery=='' && tableData.length>0" container="body" placement="right"
                      triggers="mouseenter:mouseleave" ngbPopover="Select All">
                      <input type="checkbox" [checked]="selectAll" (click)="selectAllData($event)" />
                      <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                    </label>
                  </div>
                </ng-template>

                <ng-template class="datatable-checkbox" ngx-datatable-cell-template let-row="row"
                  let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
                  <div class="checkbox-fade fade-in-primary">
                    <label *ngIf="row['specificationAdded']">
                      <input type="checkbox" name="{{row['id']}}" [checked]="row.publishFlag=='Y' ? true : false"
                        (change)="row.published = !row.published; onChangePublishData();" />
                      <span class="cr"><i class="cr-icon icofont icofont-ui-check txt-primary"></i></span>
                    </label>
                  </div>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Room ID">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['cleanRoomCode']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Room Name">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['roomName']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Room No">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['roomNo']
                    ? row['roomNo'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Classification">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template> <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['classification']
                    ? row['classification'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Building">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['building'] ?
                    row['building'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Floor">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['floor']
                    ? row['floor'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Action" [width]="200">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <ng-template #popContent>
                    <span class="text-left">
                      <div><b>Status :</b>&nbsp;{{row['workflowStatus']}}</div>
                      <div><b>Created By :</b>&nbsp;{{row['createdByUserName']}}</div>
                      <div><b>Created On :</b>&nbsp;{{row['createdDate']}}</div>
                      <div><b>Last Modified By :</b>&nbsp;{{row['updatedByUserName']}}</div>
                      <div><b>Last Modified On :</b>&nbsp;{{row['updatedDate']}}</div>
                    </span>
                  </ng-template>
                  <a container="body" href="javascript:;" class="m-r-15 crm-action-info text-muted text-primary"
                    placement="right" placement="top" (click)="loadDocumentCommentLog(row)" [ngbTooltip]="popContent">
                    <i class="icofont icofont-info-square info"></i>
                  </a>
                  <a container="body" *ngIf="permissionModal.updateButtonFlag" href="javascript:;"
                    routerLinkActive="active" [routerLink]="['/Clean-room/add-cleanroom', row.id]"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Edit">
                    <i class="icofont icofont-edit edit"></i>
                  </a>
                  <a container="body" *ngIf="permissionModal.deleteButtonFlag" href="javascript:;"
                    class="m-r-15 crm-action-delete text-muted text-danger" (click)="openDeleteSwal(row);"
                    placement="top" ngbTooltip="Delete">
                    <i class="icofont icofont-bin bin"></i>
                  </a>
                  <a container="body" *ngIf="permissionModal.viewButtonFlag" href="javascript:;"
                    class="m-r-15 crm-action-view text-muted text-warning" (click)="viewRowDetails(row.id);"
                    data-ng-open="modalSmall" placement="top" ngbTooltip="View">
                    <i class="icofont icofont-resize view"></i>
                  </a>
                  <a container="body" *ngIf="permissionModal.workFlowButtonFlag" href="javascript:;"
                    (click)="openIndividualWorkflowSetup(row)" class="text-warning" data-ng-open="modalSmall"
                    placement="top" ngbTooltip="Workflow"><i class="icofont icofont-chart-flow-alt-1"></i>
                  </a>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Published" id="publish">
          <ng-template ngbTabContent>
            <ngx-datatable #myTable [scrollbarH]="false" class="data-table dt-chk" style="overflow: unset!important;"
              [rows]='tableData | CleanRoomFilter : filterQuery' [columnMode]="'force'" [headerHeight]="50"
              [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="page.totalElements"
              [offset]="page.pageNumber" [limit]="page.size" (page)="setPage($event)">

              <ngx-datatable-column name="Room ID">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['cleanRoomCode']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Room Name">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['roomName']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Room No">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['roomNo']
                    ? row['roomNo'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Classification">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['classification']
                    ? row['classification'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Building">
                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['building'] ?
                    row['building'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Floor">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['floor']
                    ? row['floor'] : 'N/A'}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Document Status">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <strong
                    style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['workflowStatus']}}</strong>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Action" [width]="200">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <ng-template #popContent>
                    <span class="text-left">
                      <div><b>Status :</b>&nbsp;{{row['workflowStatus']}}</div>
                      <div><b>Created By :</b>&nbsp;{{row['createdByUserName']}}</div>
                      <div><b>Created On :</b>&nbsp;{{row['createdDate']}}</div>
                      <div><b>Last Modified By :</b>&nbsp;{{row['updatedByUserName']}}</div>
                      <div><b>Last Modified On :</b>&nbsp;{{row['updatedDate']}}</div>
                    </span>
                  </ng-template>
                  <a container="body" href="javascript:;" class="m-r-15 crm-action-info text-muted text-primary"
                    placement="right" placement="top" (click)="loadDocumentCommentLog(row)" [ngbTooltip]="popContent">
                    <i class="icofont icofont-info-square info"></i>
                  </a>
                  <a *ngIf="permissionModal.createButtonFlag" href="javascript:;" container="body"
                    class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Clone"
                    (click)="cloneCleanRoom(row);"><i class="icofont icofont-copy"></i>
                  </a>
                  <a container="body" *ngIf="permissionModal.viewButtonFlag" href="javascript:;" class="m-r-15 crm-action-view"
                    (click)="viewRowDetails(row.id);" data-ng-open="modalSmall" placement="top" ngbTooltip="View">
                    <i class="icofont icofont-resize view"></i>
                  </a>
                  <a *ngIf="permissionModal.createButtonFlag && row.workflowStatus == 'Completed'" href="javascript:" class="m-r-15 crm-action-edit text-muted text-primary"
                  (click)="downloadPdf(row)" placement="top" ngbTooltip="Download">
                  <i class="icofont icofont-download"></i></a>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Feedback" id="feedback">
          <ng-template ngbTabContent>
            <br>
            <app-document-forum #forumView [constant]="this.helper.CLEAN_ROOM_VALUE" [isDocumentWorkFlow]="true"
              [documentList]="this.commentsDocumentsList"></app-document-forum>
          </ng-template>
        </ngb-tab>

        <ngb-tab title="Audit Trail" id="audit">
          <ng-template ngbTabContent>
            <app-audit-trail-view #auditView [permission]="this.helper.CLEAN_ROOM_VALUE" [projects]="this.project">
            </app-audit-trail-view>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </app-card>
  </div>
</div>

<app-card *ngIf="this.individualView && popupdata">
  <div class="col-sm-12" id="float-action">
    <app-card>
      <div class="row">
        <div class="col-sm-5">
          <label><strong class="strong">Room ID : </strong>{{popupdata.cleanRoomCode}}</label>
          &nbsp;&nbsp;
          <label><strong class="strong">Room Name : </strong>{{popupdata.roomName}}</label>
        </div>
        <div class="col-sm-3">
          <label><Strong class="strong">Validation status : </Strong>{{popupdata.validationStatus}}</label>
        </div>
        <div class="col-sm-4" style="text-align: right;">
          <a *ngIf="permissionModal.updateButtonFlag && popupdata.publishFlag!='Y'" href="javascript:"
            [routerLink]="['/Clean-room/add-cleanroom', popupdata.id]" routerLinkActive="active" class="m-r-15">
            <img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/edit1.png" alt="Edit"
              placement="bottom" ngbTooltip="Edit"></a>

          <a *ngIf="permissionModal.publishButtonFlag && popupdata.publishFlag=='N' && popupdata.specificationAdded"
            href="javascript:" (click)="singleRoomPublish(popupdata.id); individualView=false" class="m-r-15"><img
              class="image-radius rounded-0 img-25" src="assets/icon/png-icons/published.png" alt="Publish"
              placement="bottom" ngbTooltip="Publish"></a>

          <a *ngIf="popupdata.publishFlag=='Y'" href="javascript:" (click)="cleanroomWorkFlow.show();"
            class="m-r-15"><img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/workflow1.png"
              alt="Workflow" placement="bottom" ngbTooltip="Workflow"></a>

          <a *ngIf="popupdata.publishFlag=='Y' && !this.status" href="javascript:"
            (click)="downloadPdf(popupdata)" class="m-r-15" placement="bottom" ngbTooltip="Pdf Download">
            <i class="icofont icofont-download" style="font-size: 1.75em;"></i></a>

          <a *ngIf="popupdata.publishFlag=='Y' && this.status" href="javascript:"
            (click)="approveOrReject(this.status);" class="m-r-15"><img class="image-radius rounded-0 img-25"
              src="assets/icon/png-icons/esign.png" alt="Esign" placement="bottom" ngbTooltip="Esign"></a>

          <a *ngIf="permissionModal.deleteButtonFlag && popupdata.publishFlag=='N'" href="javascript:"
            (click)="openDeleteSwal(popupdata);" class="m-r-15"><img class="image-radius rounded-0 img-25"
              src="assets/icon/png-icons/delete.png" alt="Delete" placement="bottom" ngbTooltip="Delete"></a>

          <a href="javascript:"><img class="image-radius rounded-0 img-30 m-r-15" src="assets/icon/png-icons/forum.png"
              alt="Forum" placement="bottom" ngbTooltip="Forum" (click)="openDocumentForum();"></a>

          <a href="javascript:" (click)="onClickClose(); individualView=false;">
            <img class="image-radius rounded-0 img-25" src="assets/icon/png-icons/cancel.png" alt="Cancel"
              placement="bottom" ngbTooltip="Cancel"></a>
        </div>
      </div>
    </app-card>
  </div>

  <div><br><br></div>

  <div class="row">
    <div class="col-sm-12">
      <table id="room-view-table" class="table w-100">
        <tbody>
          <tr>
            <td colspan="2">
              <div><strong class="strong">Location : </strong>{{popupdata.locationName}}</div>
            </td>
            <td colspan="2">
              <div><strong class="strong">Department(s) : </strong>{{popupdata.departmentName}}</div>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <div><strong class="strong">Project : </strong>
                <a href="javascript:void(0)"
                  (click)="onClickProject(popupdata.projectId)"><u>{{popupdata.projectName}}</u></a>
              </div>
            </td>
            <td colspan="2">
              <div><strong class="strong">Classification : </strong>{{popupdata.classification ?
                popupdata.classification : 'N/A'}}</div>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <div *ngIf="popupdata.roomNo || popupdata.floor"><strong class="strong">Room No/Floor : </strong>{{popupdata.roomNo ? popupdata.roomNo : 'N/A'}}/{{popupdata.floor ? popupdata.floor : 'N/A'}}</div>
              <div *ngIf="!popupdata.roomNo && !popupdata.floor"><strong class="strong">Room No/Floor : </strong>N/A</div>
            </td>
            <td colspan="2">
              <div><strong class="strong">Building : </strong>{{popupdata.building ? popupdata.building : 'N/A'}}</div>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <div><strong class="strong">Room Orientation : </strong>{{popupdata.roomOrientation ? popupdata.roomOrientation : 'N/A'}}</div>
            </td>
            <td colspan="2">
              <div><strong class="strong">Equipment(s) : </strong>
                <label *ngIf="popupdata.equipmentDto && popupdata.equipmentDto.length > 0;else empty_eqp">
                  <ng-container *ngFor="let eqp of popupdata.equipmentDto; let i = index;">
                    <a href="javascript:void(0)" (click)="equipmentRedirection(eqp.id)"><u>{{eqp.name}}<label
                          *ngIf="popupdata.equipmentDto.length!=(i+1)">,</label></u></a>
                  </ng-container>
                </label>
                <ng-template #empty_eqp>N/A</ng-template>
              </div>
            </td>
          </tr>
          <tr *ngIf="popupdata.specification">
            <td>
              <div><strong class="strong">length : </strong>{{popupdata.specification.length}}</div>
            </td>
            <td>
              <div><strong class="strong">Width : </strong>{{popupdata.specification.width}}</div>
            </td>
            <td>
              <div><strong class="strong">Height : </strong>{{popupdata.specification.height}}</div>
            </td>
            <td>
              <div><strong class="strong">Total Area(SF) : </strong>{{popupdata.specification.totalArea}}</div>
            </td>
          </tr>
        </tbody>
      </table>

      <div
        *ngIf="popupdata.specification && popupdata.specification.specificationTableInfo && popupdata.specification.specificationTableInfo.length > 0">
        <div><strong class="strong-specification">Specification :</strong></div>
        <br>
        <div class="room-summary-table">
          <div class="col-sm-12" *ngFor="let data of popupdata.specification.specificationTableInfo; let i = index;" >
          <div class ="row">
            <div><strong class="strong-category">{{data.category}}</strong></div>
          </div>
          <div class ="row" *ngFor="let sub of data.subCategoryList; let k = index;" >
            <div *ngIf=" sub.subCategory != data.category"><strong class="strong">{{sub.subCategory}}</strong></div>
            <div class="table-responsive">
              <table class="table">
                  <tr class="header-bg">
                    <th class="w-10">Sl No</th>
                    <!-- <th>Sub Category</th> -->
                    <th>Description</th>
                    <th>Acceptance Criteria</th>
                    <th>Obeservation</th>
                    <th>Updated User/Time</th>
                  </tr>
                  <tr *ngFor="let item of sub.specificationTableSubData; let i = index;">
                    <td>{{i+1}}</td>
                    <!-- <td style="white-space:initial;">{{item.subCategory}}</td> -->
                    <td style="white-space:initial;">{{item.field}}</td>
                    <td>{{item.value ? item.value : "N/A"}}</td>
                    <td style="white-space:initial;">{{item.observation ? item.observation : 'N/A'}}</td>
                    <td style="white-space:initial;">{{item.updatedBy}} {{item.updatedDate}}
                    </td>
                  </tr>
              </table>
            </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-12" *ngIf="fileFlag"><strong class="strong">View Uploaded Files :</strong></div>
        <div class="col-sm-12 p-0">
          <app-file-upload-for-doc #viewFileupload [uniqueCodeForAudit]="popupdata.cleanRoomCode"
            [documentId]="popupdata.id" [multiple]=false [onlyView]=true [documentCode]="this.helper.CLEAN_ROOM_VALUE">
          </app-file-upload-for-doc>
        </div>
      </div>
    </div>
  </div>

  <app-individual-audit-trail [permission]="this.helper.CLEAN_ROOM_VALUE" [id]="popupdata.id">
  </app-individual-audit-trail>

  <app-individual-document-forum #forumView [constant]="this.helper.CLEAN_ROOM_VALUE" [itemId]="popupdata.id"
    [documentList]=""></app-individual-document-forum>

</app-card>

<app-document-status-comment-log #documentcomments></app-document-status-comment-log>

<app-individual-document-item-workflow [permissionConstant]="this.helper.CLEAN_ROOM_VALUE"
  #individualDocumentItemWorkflow></app-individual-document-item-workflow>

<app-modal-basic #cleanroomWorkFlow [dialogClass]="'modal-lg'" [hideClickOutSide]="true"
  class="modal-dialog modal-dialog-scrollable">
  <div class="app-modal-header">
    <h4 class="modal-title strong">Workflow Configuration</h4>
    <button type="button" class="close basic-close" (click)="cleanroomWorkFlow.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div style="max-height: 400px !important;" class="app-modal-body">
    <div style="max-height: 300px !important;" class="col-sm slimScrollDiv">
      <div class="dt-desc dy-width-300">
        <ul class="progress-indicator">
          <li *ngFor="let status of this.getStatus;" class="completed">
            <label>
              <span style="white-space: pre-line;" class="bubble"></span>
              <div class="strong">{{status.levelName}} : {{status.type}}<br><br>
                <div style="text-align: left;"><b class="black"><u>Users</u></b>
          <li *ngFor="let user of status.userArray; let i = index;">{{i+1}}.{{user}}</li>
      </div>
    </div>
    </label>
    </li>
    </ul><br><br>
  </div>
  </div>
  </div>
  <div class="app-modal-footer">
  </div>
</app-modal-basic>

<app-modal-animation #documentEsign class="p-20" container="body" [modalID]="'effect-1'" [modalClass]="'md-effect-1'">
  <h3 class="pt-2 pb-1">Electronic Signature</h3>
  <form style="background: white !important;border: none;" class="well well-lg pt-1" [formGroup]="esignForm"
    (ngSubmit)="onSubmit(esignForm)">
    <div class="row">
      <label class="col-sm-6 pt-4">Please enter your Comments</label>
      <div class="col-sm-6">
        <textarea class="form-control" id="esignComments" placeholder="Comments" formControlName="comments"
          name="description" maxlength="250" cols="50" rows="3"></textarea>
      </div>
    </div>
    <div class="row">
      <strong class="col-sm-12 strong">This verification requires your electronic signature.</strong>
    </div>
    <hr class="m-2">
    <div class="row">
      <div class="col-sm-2">
        <input type="checkbox" [checked]="this.agreementCheck" name="check" (change)="onclickAccept()"> I Accept
      </div>
      <div class="col-sm-10">
        <h6>{{this.esignAgreementMessage.agreementMessage}}</h6>
      </div>
    </div>
    <div class="row pt-1" *ngIf="this.agreementCheck">
      <label class="col-sm-6">Please enter your Email Id or User Name</label>
      <div class="col-sm-6">
        <input class="form-control" size="49" formControlName="userName" type="email" autocomplete="new-password"
          placeholder="Email Id or User Name" name="userName" required />
      </div>
    </div>
    <div class="row pt-1" *ngIf="this.agreementCheck">
      <label class="col-sm-6">Please enter your Password</label>
      <div class="col-sm-6">
        <input class="form-control" size="49" formControlName="password" type="password" placeholder="password"
          name="password" autocomplete="new-password" required />
      </div>
    </div>
    <div class="row pt-1" *ngIf="this.agreementCheck">
      <div class="col-sm-6 pt-5">
        <label for="viewSignatureId">
          <input type="checkbox" [checked]="viewSignature" id="viewSignatureId"
            (click)="viewSignature=!viewSignature; viewSignature ? clearSignature() : ''" />
          &nbsp;Enable Signature Pad</label>
      </div>
      <div *ngIf="viewSignature" class="col-sm-6">
        <div class="well well-sm mb-0">
          <signature-pad [options]="signaturePadOptions" (onEndEvent)="signatureComplete()">
          </signature-pad>
        </div>
        <button type="button" *ngIf="esignForm.get('signature').value"
          class="mr-0 btn btn-sm btn-link waves-effect waves-light" (click)="clearSignature()">Clear</button>
      </div>
    </div>
    <div class="row">
      <p *ngFor="let item of errorList" class="text-danger">{{item}}</p>
      <p class="text-danger p-0" *ngIf="(this.submitted) && esignForm.get('userName').hasError('required')">
        <span>{{errorMessageHelper.usernameValidation}}</span>
      </p>
      &nbsp;&nbsp;<p class="text-danger p-0" *ngIf="(this.submitted) && esignForm.get('password').hasError('required')">
        <span>{{errorMessageHelper.passwordValidaiton}}</span>
      </p>
      &nbsp;&nbsp;<p class="text-danger p-0" *ngIf="(this.submitted) && esignForm.get('comments').hasError('required')">
        <span>{{errorMessageHelper.commentsValidation}}</span>
      </p>
    </div>
    <br>
    <button style="text-align: center;" *ngIf="this.agreementCheck" type="submit"
      class="btn btn-danger waves-effect waves-light">Esign</button>
  </form>
  <button (click)="closeMyModal($event)" aria-label="Close" class="md-close-btn">
    <i class="icofont icofont-ui-close"></i></button>
</app-modal-animation>

<app-modal-basic class="modal-lg" #selectUserModal [hideHeader]="false" [hideFooter]="false" [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h5 class="font-header"><strong>Re-Assign Users</strong></h5>
    <button type="button" class="close basic-close-light-box" (click)="selectUserModal.hide();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="row">
      <div class="col-sm-12">
        <div class="form-group row">
          <label class="col-sm-8 col-form-label">Assigned To<span class="asterisk required">*</span></label>
          <div class="col-sm-10">
            <ng-select [disabled]="!this.canEditTask" name="users" [ngClass]="'ng-select'"
              [(ngModel)]="this.assignedUsers" [options]="this.taskUserList" [multiple]="true">
            </ng-select>
            <div class="messages text-danger" *ngIf="this.assignedUsers.length==0">Assigned to is Required</div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!this.canEditTask" class="row"><span class="asterisk">&nbsp;&nbsp;&nbsp;*</span>Note: User is not in
      workflow to Re-assign users</div>
  </div>
  <div style="width: 100%;" class="app-modal-footer">
    <div class="row">
      <div style="text-align: center;" class="col-sm-12">
        <button class="btn btn-success" [disabled]="!this.canEditTask || this.assignedUsers.length==0"
          (click)="reAssignUsers();selectUserModal.hide();">Save</button>
        <button class="btn btn-danger" (click)="selectUserModal.hide();">Cancel</button>
      </div>
    </div>
  </div>
</app-modal-basic>

<div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>