<app-card>
  <label>Template Builder</label>
  <div class="container " style="margin-left: 10px;">
    <div class="row " style=" width: 55%;">
      <div class="col-sm m-0 p-0  " style="max-width: 33%;"
        *ngIf="permissionModal.createButtonFlag || this.SettingsFlag ">
        <button type="button" (click)="addTemplate(!this.addFlag)" class="btn btn-primary waves-effect waves-light "><i
            *ngIf="this.addFlag" class=" icofont icofont-list"></i> <i *ngIf="!this.addFlag"
            class=" icofont icofont-ui-add"></i> {{false==this.addFlag?' Add Template':'TemplateList'}} </button>
      </div>
      <div style="max-width: 33%;"
        *ngIf="!this.addFlag && permissionModal.createButtonFlag  && permissionModal.viewButtonFlag && !rootUser"
        class="col-sm p-l-0 ">
        <button (click)="settingsView(!this.SettingsFlag)" type="button"
          class="btn btn-primary waves-effect waves-light "><i *ngIf="!this.addFlag"
            class=" icofont icofont-settings-alt"></i> settings</button>
      </div>
      <div *ngIf="!this.addFlag && this.SettingsFlag " class="col-sm p-l-0 ">
        <button (click)="settingsView(!this.SettingsFlag)" type="button"
          class="btn btn-danger waves-effect waves-light "> Cancel</button>
      </div>
      <div *ngIf="this.addFlag " class="col-sm p-l-0 ">
        <button (click)="addTemplate(!this.addFlag)" type="button" class="btn btn-danger waves-effect waves-light ">
          Cancel</button>
      </div>
    </div>
  </div>

  <br>
  <br>
  <div *ngIf="addFlag ">
    <div class="col-sm-10" [formGroup]="templateFormController">
      <div class="container">
        <div class="row">
          <div class="col-sm-2">
            Active: <label class="switch"><input type="checkbox" name="activeFlag" [disabled]="templateModal.templateInUse" [checked]="templateModal.activeFlag"
                (change)="templateModal.activeFlag=!templateModal.activeFlag"><span class="slider round"></span></label>
          </div>
          <div class="col-sm-4">
            <input type="text" formControlName="templateName" class=" form-control form-input" name="projectCode"
              placeholder="Template Name" required>
          </div>
          <div class="col-sm-2 ">
            <button type="submit" *ngIf="templateFormController.valid" (click)="saveTemplate()"
              class="btn btn-sm btn-success waves-effect waves-light m-r-10">Save</button>
          </div>
        </div>
      </div>
    </div>
    <br>
  </div>

  <div *ngIf="!this.addFlag && !this.SettingsFlag" class="col-sm m-l-0 p-l-0 ">
    <a (click)="SwitchUi(!uiSwitch)" placement="top" ngbTooltip="{{false!=uiSwitch?'  view List ':'View Table'}}"><i
        *ngIf="uiSwitch" class="icofont icofont-list view"></i> <i *ngIf="!uiSwitch" class="icofont icofont-table"></i>
    </a>
  </div>

  <div *ngIf="!addFlag && uiSwitch && !this.SettingsFlag">
    <ngx-datatable #myTable class="data-table dt-chk" [rows]='this.templateModalArray' [limit]="10"
      [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">
      <ngx-datatable-column name="Sl No." [width]="50">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <strong>{{row['$$index']+1}}</strong>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column style="font-weight: bold;" name="Template Name">
        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
          <strong
            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['templateName']}}</strong>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column style="font-weight: bold;" name="Active Flag">
        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
          <strong
            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['activeFlag']?"Active":"Deactivated"}}</strong>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column style="font-weight: bold;" name="Created Time">
        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
          <strong
            style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: normal;">{{row['displayCreatedTime']}}</strong>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Action">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <a href="javascript:;" *ngIf="permissionModal.updateButtonFlag" (click)="edit(row)"
            class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="View and Edit">
            <i class="icofont icofont-edit edit"></i>
          </a>
          <a href="javascript:;" *ngIf="permissionModal.updateButtonFlag" (click)="modalLarge.show();test(row)"
            class="m-r-15 crm-action-edit text-muted text-primary" placement="top" ngbTooltip="Test Email">
            <i style="font-size: 25px;color: blue;" class="icofont icofont-paper-plane"></i>
          </a>
          <a href="javascript:;" *ngIf="permissionModal.deleteButtonFlag"
            class="m-r-15 crm-action-delete text-muted text-danger" (click)="swaldelete(row);" placement="top"
            ngbTooltip="Delete">
            <i class="icofont icofont-bin bin"></i>
          </a>
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>
  </div>

  <div *ngIf="!uiSwitch && !this.addFlag && !this.SettingsFlag" class="container left ">
    <h2>Templates</h2>
    <div *ngIf="permissionModal.updateButtonFlag && permissionModal.viewButtonFlag" class="row">
      <div *ngFor="let item of this.templateModalArray"
        class=" borderanimated col-xs-18 col-sm-2 col-md-2 m-r-20  m-b-20" placement="top" ngbTooltip="View and Edit">
        <div class="thumbnail">
          <img (click)="edit(item)" src="assets/icon/svg-animated/email template.svg" alt="">
          <div class="caption">
            <h5>{{ (item.templateName.length>6)? (item.templateName | slice:0:11)+'..':(item.templateName) }}</h5>
            <ul class='row'>
              <li><a style="display: inline-block;" class="btn btn-info btn-xs buttoninsideBox"
                  (click)="modalLarge.show();test(item)" role="button">test</a></li>
              <li><a style="display: inline-block;" class="btn btn-danger btn-xs buttoninsideBox"
                  (click)="swaldelete(item);" role="button">Delete</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div><!-- End row -->
  </div><!-- End container -->

  <div *ngIf="!this.addFlag && this.SettingsFlag" class="container left ">
    <h4>Settings</h4>
    <div class="container " [formGroup]="settingsFormController" style="margin-left: 10px;">
      <div class="row ">
        <div class="col-sm-3 ">
          Set Default Template <span class="asterisk">*</span>
        </div>
        <div class="col-sm-3   ">
          <select name="select" formControlName="templatefor" class="form-control" id="apiConfigurationId" required
            name="Title">
            <option value="0" disabled selected="selected">Select types</option>
            <option *ngFor="let item of this.settingsSelectionList" [ngValue]="item.key">{{item.value}}</option>
          </select>
        </div>
        <div class="col-sm-3 " style="float: right;">
          <select name="select" formControlName="templateId" class="form-control" id="apiConfigurationId" required
            name="Title">
            <option value="0" disabled selected="selected">Select Template</option>
            <option *ngFor="let item of this.templateList" [ngValue]="item.id">{{item.templateName}}</option>
          </select>
        </div>
        <br>
        <br>
        <div class="col-sm" style="float: right;">
          <button type="button" *ngIf="settingsFormController.valid" (click)="saveEmailSettings()"
            class="btn btn-sm btn-success waves-effect waves-light m-r-10">Save</button>
        </div>

        <table class="table table-framed">
          <thead style=" position: sticky; top: 0;padding: 8px 16px; ">
            <tr style=" position: sticky; top: 0;padding: 8px 16px; ">
              <th style=" position: sticky; top: 0;padding: 8px 16px; ">Default Type</th>
              <th style=" position: sticky; top: 0;padding: 8px 16px; ">Selected Template</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of this.settingsModalList">
              <td class="fontStyle">{{data.templatefor}}</td>
              <td class="fontStyle">{{data.templateName}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</app-card>

<app-modal-basic #modalLarge [hideHeader]="true" [hideFooter]="true" [dialogClass]="'modal-md'">
  <div class="app-modal-body">
    <button type="button" class="close basic-close-light-box" (click)="modalLarge.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    <div class="col-sm-12">
      users
      <ng-select [ngClass]="'ng-select'" name="user" required #user="ngModel" [options]="userList" [multiple]="true"
        [(ngModel)]="userModalList" rounds="ngModel"></ng-select>
      <div class="messages text-danger"
        *ngIf=" userModalList.length==0 && (user.touched || submitted) && user.errors?.required">Please select atleast
        one user</div>
    </div>
    <a *ngIf="userModalList.length>0" style="display: inline-block;" class="btn btn-info btn-xs buttoninsideBox"
      (click)="send();" role="button">Send</a>
  </div>
</app-modal-basic>

<div *ngIf="spinnerFlag" class="loading">Loading&#8230;</div>

<ng-container *ngIf="addFlag ">
  <div id="gjs"></div>
</ng-container>